/* original parser id follows */
/* ipnat_yysccsid[] = "@(#)yaccpar	1.9 (Berkeley) 02/21/93" */
/* (use YYMAJOR/YYMINOR for ifdefs dependent on parser version) */

#define YYBYACC 1
#define YYMAJOR 1
#define YYMINOR 9
#define YYPATCH 20141006

#define YYEMPTY        (-1)
#define ipnat_yyclearin      (ipnat_yychar = YYEMPTY)
#define ipnat_yyerrok        (ipnat_yyerrflag = 0)
#define YYRECOVERING() (ipnat_yyerrflag != 0)
#define YYENOMEM       (-2)
#define YYEOF          0
#define YYPREFIX "ipnat_yy"

#define YYPURE 0

#line 9 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
#ifdef  __FreeBSD__
# ifndef __FreeBSD_cc_version
#  include <osreldate.h>
# else
#  if __FreeBSD_cc_version < 430000
#   include <osreldate.h>
#  endif
# endif
#endif
#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>
#include <errno.h>
#if !defined(__SVR4) && !defined(__GNUC__)
#include <strings.h>
#endif
#include <sys/types.h>
#include <sys/param.h>
#include <sys/file.h>
#include <stdlib.h>
#include <stddef.h>
#include <sys/socket.h>
#include <sys/ioctl.h>
#include <netinet/in.h>
#include <netinet/in_systm.h>
#include <sys/time.h>
#include <syslog.h>
#include <net/if.h>
#include <netdb.h>
#include <arpa/nameser.h>
#include <resolv.h>
#include "ipf.h"
#include "netinet/ipl.h"
#include "ipnat_l.h"

#define	YYDEBUG	1

extern	void	ipnat_yyerror __P((char *));
extern	int	ipnat_yyparse __P((void));
extern	int	ipnat_yylex __P((void));
extern	int	ipnat_yydebug;
extern	FILE	*ipnat_yyin;
extern	int	ipnat_yylineNum;

static	ipnat_t		*nattop = NULL;
static	ipnat_t		*nat = NULL;
static	int		natfd = -1;
static	ioctlfunc_t	natioctlfunc = NULL;
static	addfunc_t	nataddfunc = NULL;
static	int		suggest_port = 0;
static	proxyrule_t	*prules = NULL;
static	int		parser_error = 0;

static	void	newnatrule __P((void));
static	void	setnatproto __P((int));
static	void	setmapifnames __P((void));
static	void	setrdrifnames __P((void));
static	void	proxy_setconfig __P((int));
static	void	proxy_unsetconfig __P((void));
static	namelist_t *proxy_dns_add_pass __P((char *, char *));
static	namelist_t *proxy_dns_add_block __P((char *, char *));
static	void	proxy_addconfig __P((char *, int, char *, namelist_t *));
static	void	proxy_loadconfig __P((int, ioctlfunc_t, char *, int,
				      char *, namelist_t *));
static	void	proxy_loadrules __P((int, ioctlfunc_t, proxyrule_t *));
static	void	setmapifnames __P((void));
static	void	setrdrifnames __P((void));
static	void	setifname __P((ipnat_t **, int, char *));
static	int	addname __P((ipnat_t **, char *));
#line 80 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
#ifdef YYSTYPE
#undef  YYSTYPE_IS_DECLARED
#define YYSTYPE_IS_DECLARED 1
#endif
#ifndef YYSTYPE_IS_DECLARED
#define YYSTYPE_IS_DECLARED 1
typedef union	{
	char	*str;
	u_32_t	num;
	struct {
		i6addr_t	a;
		int		f;
	} ipa;
	frentry_t	fr;
	frtuc_t	*frt;
	u_short	port;
	struct	{
		int	p1;
		int	p2;
		int	pc;
	} pc;
	struct	{
		i6addr_t	a;
		i6addr_t	m;
		int	t;		/* Address type */
		int	u;
		int	f;		/* Family */
		int	v;		/* IP version */
		int	s;		/* 0 = number, 1 = text */
		int	n;		/* number */
	} ipp;
	union	i6addr	ip6;
	namelist_t	*names;
} YYSTYPE;
#endif /* !YYSTYPE_IS_DECLARED */
#line 128 "ipnat_y.c"

/* compatibility with bison */
#ifdef YYPARSE_PARAM
/* compatibility with FreeBSD */
# ifdef YYPARSE_PARAM_TYPE
#  define YYPARSE_DECL() ipnat_yyparse(YYPARSE_PARAM_TYPE YYPARSE_PARAM)
# else
#  define YYPARSE_DECL() ipnat_yyparse(void *YYPARSE_PARAM)
# endif
#else
# define YYPARSE_DECL() ipnat_yyparse(void)
#endif

/* Parameters sent to lex. */
#ifdef YYLEX_PARAM
# define YYLEX_DECL() ipnat_yylex(void *YYLEX_PARAM)
# define YYLEX ipnat_yylex(YYLEX_PARAM)
#else
# define YYLEX_DECL() ipnat_yylex(void)
# define YYLEX ipnat_yylex()
#endif

/* Parameters sent to ipnat_yyerror. */
#ifndef YYERROR_DECL
#define YYERROR_DECL() ipnat_yyerror(const char *s)
#endif
#ifndef YYERROR_CALL
#define YYERROR_CALL(msg) ipnat_yyerror(msg)
#endif

extern int YYPARSE_DECL();

#define YY_NUMBER 257
#define YY_HEX 258
#define YY_STR 259
#define YY_COMMENT 260
#define YY_CMP_EQ 261
#define YY_CMP_NE 262
#define YY_CMP_LE 263
#define YY_CMP_GE 264
#define YY_CMP_LT 265
#define YY_CMP_GT 266
#define YY_RANGE_OUT 267
#define YY_RANGE_IN 268
#define YY_IPV6 269
#define IPNY_MAPBLOCK 270
#define IPNY_RDR 271
#define IPNY_PORT 272
#define IPNY_PORTS 273
#define IPNY_AUTO 274
#define IPNY_RANGE 275
#define IPNY_MAP 276
#define IPNY_BIMAP 277
#define IPNY_FROM 278
#define IPNY_TO 279
#define IPNY_MASK 280
#define IPNY_PORTMAP 281
#define IPNY_ANY 282
#define IPNY_ROUNDROBIN 283
#define IPNY_FRAG 284
#define IPNY_AGE 285
#define IPNY_ICMPIDMAP 286
#define IPNY_PROXY 287
#define IPNY_TCP 288
#define IPNY_UDP 289
#define IPNY_TCPUDP 290
#define IPNY_STICKY 291
#define IPNY_MSSCLAMP 292
#define IPNY_TAG 293
#define IPNY_TLATE 294
#define IPNY_POOL 295
#define IPNY_HASH 296
#define IPNY_NO 297
#define IPNY_REWRITE 298
#define IPNY_PROTO 299
#define IPNY_ON 300
#define IPNY_SRC 301
#define IPNY_DST 302
#define IPNY_IN 303
#define IPNY_OUT 304
#define IPNY_DIVERT 305
#define IPNY_CONFIG 306
#define IPNY_ALLOW 307
#define IPNY_DENY 308
#define IPNY_DNS 309
#define IPNY_INET 310
#define IPNY_INET6 311
#define IPNY_SEQUENTIAL 312
#define IPNY_DSTLIST 313
#define IPNY_PURGE 314
#define YYERRCODE 256
typedef int YYINT;
static const YYINT ipnat_yylhs[] = {                           -1,
    0,    0,    0,    0,    0,   27,   27,   28,   32,   30,
   31,   31,   31,   31,   31,   39,   34,   34,   33,   33,
   33,   33,   33,   33,   35,   49,   35,   36,   36,   36,
   36,   37,   38,   42,   59,   60,   29,   25,   25,   26,
   26,   26,   26,   54,   61,   61,   55,   55,   56,   58,
   62,   63,   23,   23,   24,   24,   22,   64,   22,   43,
   43,   43,   43,   43,   46,   46,   46,   46,   17,   66,
   17,   67,   17,   68,   12,   12,   18,   18,   18,   19,
   19,   19,   65,    1,    1,   21,   21,   21,   51,   51,
   52,   52,   52,   48,   48,   48,   40,   40,   50,   47,
   10,   10,   10,   11,   11,   11,   69,   70,   41,   41,
   71,   72,   72,   72,   73,   45,   45,   45,   45,    8,
    8,    6,    9,    9,    7,   16,   16,   16,   16,   16,
   16,   16,   16,   16,   16,   16,   76,   77,   78,   79,
   20,   20,   44,   53,   84,   84,   80,   80,   81,   81,
   82,   82,   82,   86,   86,   83,   83,   74,   74,   74,
   74,   75,   75,   85,   85,   87,   87,   57,   57,    5,
    5,    5,    5,    2,   13,   13,   13,   13,   13,    3,
    3,    3,    3,    3,    3,    3,    4,    4,    4,   15,
   15,   14,
};
static const YYINT ipnat_yylen[] = {                            2,
    1,    1,    2,    2,    3,    2,    1,    4,    1,    0,
    2,    2,    2,    2,    2,    1,    0,    1,    7,    7,
    6,    7,    6,    7,    7,    0,    7,    9,    7,    8,
    6,    7,    7,    1,    0,    0,   12,    1,    3,    2,
    2,    3,    3,    3,    1,    1,    0,    2,    6,    9,
    1,    1,    1,    3,    1,    3,    0,    0,    3,    0,
    6,    6,    8,    8,    0,    1,    1,    3,    1,    0,
    4,    0,    5,    0,    4,    1,    1,    3,    4,    1,
    3,    3,    1,    1,    1,    1,    3,    3,    0,    2,
    0,    2,    3,    0,    2,    2,    1,    1,    1,    1,
    4,    5,    5,    4,    5,    5,    1,    1,    2,    4,
    1,    0,    1,    1,    1,    4,    4,    4,    4,    1,
    3,    1,    1,    3,    1,    1,    1,    3,    3,    3,
    3,    3,    3,    3,    3,    3,    1,    1,    1,    1,
    2,    3,    7,    8,    0,    2,    0,    1,    0,    1,
    0,    2,    4,    0,    1,    0,    2,    1,    1,    1,
    3,    0,    1,    0,    1,    2,    1,    0,    1,    1,
    1,    1,    1,    1,    1,    1,    1,    1,    2,    1,
    1,    1,    1,    1,    1,    1,    1,    1,    1,    1,
    1,    7,
};
static const YYINT ipnat_yydefred[] = {                         0,
    0,    7,    0,    1,    2,    0,    9,    0,   35,    3,
    4,    0,  100,   99,   97,   98,   16,    0,    0,    6,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    5,   45,   46,    0,    0,    0,   18,   11,   12,
   13,   14,   15,    0,    0,    0,  111,    0,    0,    0,
    0,    8,    0,    0,    0,    0,    0,    0,   26,    0,
    0,  175,  178,  107,  126,  139,  140,    0,    0,  177,
    0,    0,    0,    0,  113,  114,    0,  109,    0,    0,
    0,    0,    0,    0,  170,  173,    0,  172,   67,   66,
   48,    0,   44,    0,    0,    0,    0,    0,    0,  179,
    0,   34,    0,  138,  137,    0,    0,    0,    0,    0,
  122,    0,    0,  115,    0,    0,    0,    0,   83,    0,
    0,    0,    0,  171,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,   69,    0,    0,  174,
  191,  130,  190,  129,    0,  132,  131,    0,    0,  108,
    0,    0,  133,  134,  135,  136,  110,    0,    0,    0,
    0,    0,   77,   76,    0,   84,   85,    0,   90,    0,
    0,    0,   68,   51,    0,    0,    0,    0,   23,   21,
    0,   31,    0,    0,    0,   70,    0,    0,    0,    0,
    0,    0,    0,  181,  182,  184,  186,  183,  185,  180,
    0,    0,  121,    0,    0,    0,  101,  125,    0,    0,
    0,    0,    0,    0,   74,    0,    0,    0,    0,    0,
  104,    0,  169,   32,    0,   33,    0,   27,   29,    0,
   72,    0,    0,  159,  160,    0,    0,    0,    0,  148,
   22,    0,   24,   19,   20,  187,  188,  189,    0,  141,
  102,  103,    0,   95,   96,   25,  105,    0,    0,    0,
   92,    0,   78,    0,   87,   88,  106,   36,    0,   58,
   53,    0,    0,    0,    0,   71,    0,    0,    0,    0,
    0,    0,    0,  150,    0,  142,  124,   79,   30,    0,
   93,   75,    0,    0,    0,    0,   52,    0,    0,  192,
   73,  161,  163,  117,  118,  116,  119,    0,    0,    0,
    0,    0,   28,    0,    0,    0,   38,   54,   59,    0,
    0,   80,    0,    0,    0,    0,    0,    0,    0,    0,
   40,    0,   41,    0,    0,    0,    0,   55,   49,    0,
    0,    0,    0,  157,    0,    0,  155,    0,   42,   43,
   37,   39,   81,   82,    0,    0,    0,    0,  153,  146,
    0,    0,   56,    0,   64,   63,  165,  143,    0,  167,
    0,   50,  166,    0,  144,
};
static const YYINT ipnat_yydgoto[] = {                          3,
  168,  142,  202,  249,   90,  109,  206,  110,  207,   68,
   81,  161,   69,   70,  144,  208,  138,  164,  323,  203,
  169,  271,  272,  339,  316,  317,    4,    5,   12,    6,
   20,    8,   21,   39,   22,   23,   24,   25,   26,   27,
   48,  103,  190,  241,  191,   91,   28,  210,   97,   29,
  120,  213,  289,   35,   55,  175,  224,  177,   31,  294,
   36,  176,  298,  296,  121,  232,  275,  262,   72,  152,
   49,   78,  115,  237,  304,  106,  107,   73,   74,  242,
  285,  311,  329,  346,  368,  348,  371,
};
static const YYINT ipnat_yysindex[] = {                      -216,
   -2,    0, -185,    0,    0,  147,    0, -220,    0,    0,
    0,    6,    0,    0,    0,    0,    0, -108, -108,    0,
   22,   22,   22,   48,   53,  193, -163, -163, -163,   70,
 -167,    0,    0,    0, -154, -134, -154,    0,    0,    0,
    0,    0,    0, -163, -163, -163,    0, -131,  -44, -142,
  -26,    0,  111,  -89, -106, -163, -106, -131,    0,  -26,
  -27,    0,    0,    0,    0,    0,    0, -119,  -31,    0,
 -119, -142,  122,  122,    0,    0,  -76,    0, -119, -106,
 -119,  -80,  285,   57,    0,    0,  142,    0,    0,    0,
    0, -119,    0, -119,  -89,  -89, -142,  -89,  -80,    0,
  -50,    0, -102,    0,    0,  -95,  -79, -102,  -80,  -24,
    0, -173, -141,    0,  -99, -142, -142,  -98,    0, -119,
 -109, -142,  -77,    0,  -91,  -59,  -64,  -64,  185,  217,
  -89,  224,  -89,  256, -208,  -33,    0, -105,  262,    0,
    0,    0,    0,    0,  262,    0,    0, -105,  -37,    0,
  -77,  911,    0,    0,    0,    0,    0,   55,  -77, -208,
  -80,  -15,    0,    0,  -98,    0,    0,   46,    0,  -77,
 -142,   71,    0,    0,   18, -102,   18, -142,    0,    0,
  294,    0,  299,  118,  334,    0,  -72,  124,  -80,  109,
  109,  109,  109,    0,    0,    0,    0,    0,    0,    0,
   37, -109,    0, -142, -142,  -80,    0,    0, -217,  109,
 -142,  348,  -89,  -25,    0, -208,  -80, -109, -109, -142,
    0,  274,    0,    0,  -36,    0,  356,    0,    0,  359,
    0, -208,  363,    0,    0,   23, -125, -109,  -38,    0,
    0,  128,    0,    0,    0,    0,    0,    0, -109,    0,
    0,    0,  -37,    0,    0,    0,    0, -208,  109, -109,
    0, -208,    0,  -89,    0,    0,    0,    0,  352,    0,
    0,  117, -109,  165, -208,    0,  137,  123,  123,  123,
  123,  188,  194,    0,  169,    0,    0,    0,    0,  128,
    0,    0,  109,   17, -109, -109,    0, -190,  117,    0,
    0,    0,    0,    0,    0,    0,    0,  409,  410,  220,
  199,  169,    0,  -13,  -11,  433,    0,    0,    0,  453,
   21,    0,  -21, -142,   57,   57,  457,  249,  214,  221,
    0,  254,    0,  257,  -94,   60,  456,    0,    0,  474,
  213,  227,  277,    0,  280,  -89,    0,  199,    0,    0,
    0,    0,    0,    0, -109, -109,  281,  288,    0,    0,
  234,  263,    0,  264,    0,    0,    0,    0, -151,    0,
  214,    0,    0,  234,    0,
};
static const YYINT ipnat_yyrindex[] = {                       189,
    0,    0,  189,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
  568,  568,  568,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,  273,    0,  273,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,  242,    0,
    0,    0,    0,  278,    0,    0,    0,    0,    0,    0,
    1,    0,    0,    0,    0,    0,    0,    0,   97,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,  261,    0,    0,    0,    0,  695,    0,    0,    0,
    0,    0,    0,    0,  499,  499,    0,  499,  150,    0,
    0,    0,    0,    0,    0,    0,    0,    0,  -22,    0,
    0,    0,    0,    0,  242,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
  499,    0,  499,    0,    0,  144,    0,  599,   50,    0,
    0,    0,    0,    0,    0,    0,    0,  599,    0,    0,
    0,    0,    0,    0,    0,    0,    0,  396,    0,    0,
  349,  238,    0,    0,    0,    0,    0,  191,    0,    0,
    0,    0,    0,    0,  505,    0,  505,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,  648,
  648,  648,  648,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,  -49,    0,    0,    0,  648,
    0,    0,  850,    0,    0,    0,  349,    0,    0,    0,
    0,    0,    0,    0,  267,    0,    0,    0,    0,    0,
    0,    0,  300,    0,    0,    0,    0,    0,    0,    0,
    0,  737,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,  890,    0,
    0,    0,    0,  850,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,  443,  443,  443,
  443,    0,    0,    0,  826,    0,    0,    0,    0,  964,
    0,    0,  890,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
  939, 1021,    0,    0,    0,    0,    0,    0,    0,    0,
  -18,    0,  -55,    0,    0,    0,  784,    0, 1006, 1046,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
  490,  532,    0,    0,    0, 1106,    0, 1070,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
  101,  601,    0,    0,    0,    0,    0,    0,    0,    0,
 1094,    0,    0,  101,    0,
};
static const YYINT ipnat_yygindex[] = {                         0,
  661,  458,    0,    0,  -62,    0,    0,   -3,  -68,   67,
  506,  407, 1270,  244,  468,  -45,  -83,  284,    0,  325,
 -150,  271,    0,    0,    0,  251,  576,  592,    0,    0,
    0,    0,    0,  340,    0,    0,    0,    0,    0,  570,
  517,   19, -127,   13,  452,  -78,  577,    0,    0,  578,
  503,  390,  317,  594,  574,    0,  438,    0,    0,    0,
    0,  488,  318,    0, -107,    0,    0,    0,   -4,  -81,
    0,  507,    0,  382,  192,  292,    0,    0,    0, -231,
  331,  311,  276,  258,  253,    0,    0,
};
#define YYTABLESIZE 1568
static const YYINT ipnat_yytable[] = {                         77,
  176,  149,   71,   57,   79,   82,   80,  270,  151,  123,
  120,  186,   96,  105,   99,  105,  129,  130,  101,  132,
  192,  125,  270,  200,  148,  127,  111,  290,  215,  216,
  351,  105,  332,  176,  334,  260,  236,  111,   30,  254,
  127,  171,    1,    2,  176,  176,   83,  176,   61,  128,
   62,  131,  181,  214,  183,   83,  255,  137,    7,  176,
   63,  290,  137,  261,   32,  216,   61,  105,   62,  204,
  158,  111,  163,    1,    2,  117,  111,  211,   63,  123,
   38,  239,  128,  153,  160,  154,  280,  281,  220,  108,
  218,   65,  225,  128,  248,   47,  127,  116,  253,  118,
  164,    9,  221,  219,   66,   67,   42,  373,  128,  214,
  127,   43,  128,  159,   61,  155,   62,  156,  170,  163,
  119,   92,  320,   94,   95,   61,   63,   62,   52,  127,
  137,  166,  227,  167,  259,  251,  252,   63,  165,   65,
  127,   53,  257,  127,   54,  319,   64,  166,  279,  167,
   65,  267,   66,   67,   61,  127,   62,   84,   61,  164,
   62,  139,  140,   66,   67,   56,   63,   85,  105,   86,
   63,   64,  135,  141,  102,  187,  160,  145,  140,   65,
  188,  189,  114,   65,  166,  293,  167,  127,  126,  141,
   86,  119,   66,   67,   33,   34,   66,   67,   87,   88,
   89,  150,  127,  243,  244,  245,  134,  123,   89,  123,
   75,   76,  314,  315,  172,  233,  234,  235,  166,  166,
  282,  167,  256,  194,  195,  196,  197,  198,  199,  173,
   61,  166,   62,  167,  370,  269,  174,  127,  123,  123,
  123,  100,   63,  179,  123,  331,  104,  333,  104,   86,
  337,   64,  163,  127,  150,   65,  120,  176,   57,  176,
  176,  239,  341,  342,  104,   75,   76,  361,   66,   67,
  176,  176,  176,  176,  112,  180,  176,  176,  340,  176,
  176,  176,  182,  176,  176,  176,  176,  176,  176,  176,
  176,  176,  176,  176,  176,  127,  127,  176,  176,  158,
  104,  184,  176,  246,  247,  176,  128,  101,  128,  128,
  233,  234,  235,   85,  176,   86,  353,  122,  354,  128,
  128,  128,  128,  314,  315,  128,  128,  209,  128,  222,
  128,  223,  128,  128,  128,  128,  128,  128,  128,  128,
  128,  128,  128,  128,  124,   88,  128,  128,   91,  143,
  143,  128,  228,  127,  128,  127,  127,  229,  158,  164,
  164,   40,   41,  128,  112,  113,  127,  127,  127,  127,
  164,  164,  127,  127,  230,  127,  164,  164,  231,  127,
  127,  127,  238,  127,  127,  127,  127,  164,  127,  127,
  127,  240,  258,  127,  127,   94,  268,  164,  164,  273,
  127,  127,  127,  127,  274,  164,   89,   91,   89,  277,
  127,  284,  295,  127,  127,  127,   13,   14,  297,  127,
  127,  300,   15,   16,  127,  302,  127,  127,  127,  127,
  127,  127,  127,  127,  303,  127,  127,   89,   89,   89,
  127,  127,  162,   17,   18,  127,  308,   86,  127,   86,
   86,   19,  309,  310,   94,  325,  326,  127,   10,   10,
   86,   86,   13,   14,   10,   10,   86,   86,   15,   16,
  305,  306,  307,   86,   86,   86,  327,   86,   86,   86,
   86,   86,   86,   86,   86,   10,   10,   86,   86,   62,
  328,  335,   86,   10,  127,   86,  127,  127,  112,  336,
  112,  162,   86,  343,   86,  344,  345,  127,  127,  127,
  112,  347,  349,  127,  127,  350,  355,  356,  357,  112,
  127,  127,  127,  112,  127,  127,  127,  127,  127,  127,
  127,   61,  358,  359,  127,  127,  112,  112,  360,  365,
  112,   61,  127,   62,   50,   51,  366,  367,   62,  369,
   47,  127,  372,   63,   89,   65,  158,   65,  158,  158,
   58,   59,   60,  168,  146,   98,   65,   17,   57,  158,
  158,  217,   93,  158,  147,  158,  158,  287,   10,   66,
   67,  322,  158,  158,  158,  352,  158,  158,  158,  158,
   61,  158,  158,  338,   11,   44,  158,  158,   60,  193,
   60,  133,   45,   46,  158,   91,  264,   91,   91,  313,
   57,  158,   37,  158,  226,  178,  324,  278,   91,   91,
  312,  157,  330,  362,   91,   91,  375,    0,  374,    0,
    0,   91,   91,   91,    0,   91,   91,   91,   91,   91,
   91,   91,    0,    0,    0,   91,   91,  147,    0,    0,
    0,    0,   94,   91,   94,   94,    0,   60,    0,   60,
    0,    0,   91,    0,    0,   94,   94,    0,    0,    0,
    0,   94,   94,    0,    0,    0,    0,    0,   94,   94,
   94,    0,   94,   94,   94,   94,    0,   94,   94,    0,
    0,    0,   94,   94,  171,    0,    0,    0,    0,  162,
   94,  162,  162,    0,    0,    0,  147,    0,    0,   94,
    0,    0,  162,  162,    0,    0,    0,    0,  162,  162,
    0,    0,    0,    0,    0,  162,  162,  162,    0,  162,
  162,  162,  162,    0,  162,  162,  149,    0,    0,  162,
  162,    0,    0,    0,    0,    0,   62,  162,   62,   62,
    0,    0,    0,  171,    0,    0,  162,    0,    0,   62,
   62,    0,    0,    0,    0,   62,   62,    0,    0,    0,
    0,    0,   62,   62,   62,    0,   62,   62,   62,   62,
    0,   62,   62,  152,    0,    0,   62,   62,   61,    0,
   61,   61,    0,    0,   62,  149,    0,    0,    0,    0,
    0,   61,   61,   62,    0,    0,    0,   61,   61,  201,
    0,    0,    0,    0,   61,   61,   61,    0,   61,   61,
   61,   61,    0,   61,   61,  151,   17,   17,   61,   61,
    0,    0,    0,    0,    0,    0,   61,   17,   17,    0,
    0,    0,  152,   17,   17,   61,    0,    0,    0,   65,
    0,    0,    0,    0,   17,   60,    0,   60,   60,   60,
   60,    0,  250,    0,   17,   17,    0,    0,   60,   60,
   60,   60,   17,    0,   60,   60,   60,   60,  265,  266,
    0,   60,   60,   60,  151,    0,   60,   60,   60,  147,
   60,   60,    0,   60,    0,   60,   60,   60,   60,  283,
    0,    0,    0,   60,  147,   60,  147,  147,   65,  286,
    0,    0,   60,  201,   60,    0,    0,  147,  147,    0,
  291,    0,    0,  147,  147,    0,    0,    0,    0,    0,
    0,  147,  147,  299,  147,  147,  147,  147,  156,  147,
  147,    0,    0,  205,  147,  147,    0,    0,  147,    0,
    0,    0,  147,  171,  171,  318,    0,    0,    0,    0,
    0,  147,    0,  149,  171,  171,    0,    0,    0,    0,
  171,  171,  171,    0,    0,    0,    0,  171,  171,  171,
    0,  171,    0,    0,    0,  171,  171,  171,    0,    0,
    0,  171,  171,  149,    0,  149,  149,  156,    0,  171,
    0,    0,    0,    0,    0,  145,  149,  149,  171,    0,
    0,    0,  149,  149,    0,  363,  364,    0,    0,    0,
  151,  149,  149,  149,  149,  149,  149,    0,  149,  149,
    0,    0,    0,  149,  149,    0,    0,    0,    0,    0,
  152,  149,  152,  152,    0,  154,    0,    0,    0,    0,
  149,    0,    0,  152,  152,    0,    0,    0,    0,  152,
  152,    0,    0,    0,  145,    0,    0,    0,    0,  156,
  152,  152,  152,  152,  152,  152,  152,    0,    0,  151,
  152,  152,  151,    0,  151,  151,    0,    0,  152,    0,
    0,    0,    0,  145,    0,  151,  151,  152,    0,    0,
    0,  151,  151,    0,  154,   65,    0,    0,    0,   65,
    0,    0,  151,  151,  151,  151,    0,  151,  151,   65,
   65,    0,  151,  151,    0,   65,   65,    0,  156,    0,
  151,    0,   65,   65,   65,    0,   65,    0,    0,  151,
   65,   65,   65,    0,    0,    0,   65,   65,  147,  147,
    0,    0,  145,    0,   65,    0,    0,    0,    0,  147,
  147,    0,    0,   65,   65,  147,  147,   61,    0,   62,
    0,    0,    0,  147,  147,    0,  147,    0,    0,   63,
  147,  147,  147,    0,    0,    0,  147,  147,    0,    0,
    0,    0,   65,    0,  147,  156,    0,  156,  156,    0,
    0,    0,    0,  147,    0,   66,   67,    0,  156,  156,
    0,    0,    0,    0,  156,  156,    0,    0,    0,    0,
    0,    0,  149,  149,    0,  156,  156,  156,  156,    0,
    0,  156,    0,  149,  149,  156,  156,    0,    0,  149,
  149,    0,    0,  156,    0,    0,    0,    0,  149,    0,
  149,    0,  156,    0,  149,  149,  149,    0,    0,    0,
  149,  149,  145,    0,  145,  145,    0,    0,  149,    0,
    0,    0,    0,    0,    0,  145,  145,  149,    0,  151,
  151,  145,  145,    0,    0,    0,    0,    0,    0,    0,
  151,  151,  145,  145,  145,  145,  151,  151,    0,    0,
    0,    0,  145,  145,  154,  154,    0,  151,    0,    0,
  145,  151,  151,  151,    0,  154,  154,  151,  151,  145,
    0,  154,  154,    0,    0,  151,    0,    0,  156,  156,
    0,    0,  154,    0,  151,    0,    0,  154,  154,  156,
  156,    0,  154,  154,    0,  156,  156,    0,    0,    0,
  154,    0,  145,  145,    0,    0,  156,    0,    0,  154,
    0,    0,  156,  145,  145,   65,  156,  156,    0,  145,
  145,    0,  136,    0,  156,   65,   65,  136,    0,    0,
  145,   65,   65,  156,    0,    0,    0,  162,    0,    0,
  145,  145,   65,    0,    0,    0,    0,    0,  145,    0,
    0,    0,   65,   65,  185,    0,    0,  145,    0,    0,
   65,    0,    0,    0,    0,    0,    0,    0,    0,   65,
    0,    0,    0,    0,    0,    0,    0,    0,    0,  212,
    0,    0,    0,    0,  162,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,  136,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,  263,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,  276,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,  288,    0,    0,
    0,  292,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,  301,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
    0,    0,    0,    0,    0,    0,    0,  321,
};
static const YYINT ipnat_yycheck[] = {                         44,
    0,  109,   48,   59,   50,   51,   33,   44,   33,   59,
   33,   45,   58,   47,   60,   47,   95,   96,   46,   98,
  148,   84,   44,   61,  108,   44,   72,  259,   44,   45,
  125,   47,   46,   33,   46,   61,  187,   83,  259,  257,
   59,  123,  259,  260,   44,   45,   51,   47,  257,    0,
  259,   97,  131,  161,  133,   60,  274,  103,   61,   59,
  269,  293,  108,  214,   59,   45,  257,   47,  259,  151,
  116,  117,  118,  259,  260,   80,  122,  159,  269,   83,
   59,  189,   33,  257,  275,  259,  237,  238,  170,   71,
   45,  282,  176,   44,   58,  259,    0,   79,  206,   81,
    0,  287,  171,   58,  295,  296,   59,  259,   59,  217,
   92,   59,   94,  117,  257,  257,  259,  259,  122,  165,
  272,   55,  313,   57,   58,  257,  269,  259,   59,   33,
  176,  257,  178,  259,  213,  204,  205,  269,  120,  282,
   44,  309,  211,    0,  299,  296,  278,  257,  274,  259,
  282,  220,  295,  296,  257,   59,  259,   47,  257,   59,
  259,  257,  258,  295,  296,  300,  269,  257,   47,  259,
  269,  278,  275,  269,  294,  281,  275,  257,  258,  282,
  286,  287,  259,  282,  257,  264,  259,   44,   47,  269,
    0,  272,  295,  296,  303,  304,  295,  296,  288,  289,
  290,  279,   59,  191,  192,  193,  257,  257,   59,  259,
  310,  311,  307,  308,  306,  288,  289,  290,  257,  257,
  259,  259,  210,  261,  262,  263,  264,  265,  266,  289,
  257,  257,  259,  259,  362,  272,  301,    0,  288,  289,
  290,  269,  269,   59,  294,  259,  280,  259,  280,   59,
  272,  278,  298,  272,  279,  282,  279,  257,  314,  259,
  260,  369,  325,  326,  280,  310,  311,  346,  295,  296,
  270,  271,  272,  273,   33,   59,  276,  277,  324,  279,
  280,  281,   59,  283,  284,  285,  286,  287,  288,  289,
  290,  291,  292,  293,  294,  314,   59,  297,  298,    0,
  280,   46,  302,  267,  268,  305,  257,   46,  259,  260,
  288,  289,  290,  257,  314,  259,  257,   33,  259,  270,
  271,  272,  273,  307,  308,  276,  277,  273,  279,  259,
  281,  314,  283,  284,  285,  286,  287,  288,  289,  290,
  291,  292,  293,  294,  288,  289,  297,  298,    0,  106,
  107,  302,   59,  257,  305,  259,  260,   59,   59,  259,
  260,   22,   23,  314,   73,   74,  270,  271,  272,  273,
  270,  271,  276,  277,  257,  279,  276,  277,   45,  283,
  284,  285,  259,  287,  288,  289,  290,  287,  292,  293,
  294,  283,   45,  297,  298,    0,  123,  297,  298,   44,
  257,  305,  259,  260,   46,  305,  257,   59,  259,   47,
  314,  284,   61,  270,  271,  272,  270,  271,  302,  276,
  277,  257,  276,  277,  281,  289,  283,  284,  285,  286,
  287,  288,  289,  290,  312,  292,  293,  288,  289,  290,
  297,  298,    0,  297,  298,  302,  259,  257,  305,  259,
  260,  305,  259,  285,   59,   47,   47,  314,  270,  271,
  270,  271,  270,  271,  276,  277,  276,  277,  276,  277,
  279,  280,  281,  283,  284,  285,  257,  287,  288,  289,
  290,  291,  292,  293,  294,  297,  298,  297,  298,    0,
  292,   59,  302,  305,  257,  305,  259,  260,  257,   47,
  259,   59,  312,   47,  314,  257,  293,  270,  271,  272,
  269,  291,  259,  276,  277,  259,   61,   44,  306,  278,
  283,  284,  285,  282,  287,  288,  289,  290,  291,  292,
  293,    0,  306,  257,  297,  298,  295,  296,  259,  259,
  299,  257,  305,  259,   28,   29,  259,  314,   59,  287,
  278,  314,  289,  269,  294,  278,  257,   59,  259,  260,
   44,   45,   46,   59,  107,   60,  282,    0,  302,  270,
  271,  165,   56,  274,  107,  276,  277,  253,    3,  295,
  296,  298,  283,  284,  285,  335,  287,  288,  289,  290,
   59,  292,  293,  323,    3,   26,  297,  298,    0,  148,
    0,   99,   26,   26,  305,  257,  217,  259,  260,  293,
   37,  312,   19,  314,  177,  128,  299,  236,  270,  271,
  290,  115,  312,  348,  276,  277,  374,   -1,  371,   -1,
   -1,  283,  284,  285,   -1,  287,  288,  289,  290,  291,
  292,  293,   -1,   -1,   -1,  297,  298,    0,   -1,   -1,
   -1,   -1,  257,  305,  259,  260,   -1,   59,   -1,   59,
   -1,   -1,  314,   -1,   -1,  270,  271,   -1,   -1,   -1,
   -1,  276,  277,   -1,   -1,   -1,   -1,   -1,  283,  284,
  285,   -1,  287,  288,  289,  290,   -1,  292,  293,   -1,
   -1,   -1,  297,  298,    0,   -1,   -1,   -1,   -1,  257,
  305,  259,  260,   -1,   -1,   -1,   59,   -1,   -1,  314,
   -1,   -1,  270,  271,   -1,   -1,   -1,   -1,  276,  277,
   -1,   -1,   -1,   -1,   -1,  283,  284,  285,   -1,  287,
  288,  289,  290,   -1,  292,  293,    0,   -1,   -1,  297,
  298,   -1,   -1,   -1,   -1,   -1,  257,  305,  259,  260,
   -1,   -1,   -1,   59,   -1,   -1,  314,   -1,   -1,  270,
  271,   -1,   -1,   -1,   -1,  276,  277,   -1,   -1,   -1,
   -1,   -1,  283,  284,  285,   -1,  287,  288,  289,  290,
   -1,  292,  293,    0,   -1,   -1,  297,  298,  257,   -1,
  259,  260,   -1,   -1,  305,   59,   -1,   -1,   -1,   -1,
   -1,  270,  271,  314,   -1,   -1,   -1,  276,  277,  149,
   -1,   -1,   -1,   -1,  283,  284,  285,   -1,  287,  288,
  289,  290,   -1,  292,  293,    0,  259,  260,  297,  298,
   -1,   -1,   -1,   -1,   -1,   -1,  305,  270,  271,   -1,
   -1,   -1,   59,  276,  277,  314,   -1,   -1,   -1,    0,
   -1,   -1,   -1,   -1,  287,  257,   -1,  259,  260,  259,
  260,   -1,  202,   -1,  297,  298,   -1,   -1,  270,  271,
  270,  271,  305,   -1,  276,  277,  276,  277,  218,  219,
   -1,  283,  284,  285,   59,   -1,  288,  289,  290,    0,
  292,  293,   -1,  293,   -1,  297,  298,  297,  298,  239,
   -1,   -1,   -1,  305,  257,  305,  259,  260,   59,  249,
   -1,   -1,  314,  253,  314,   -1,   -1,  270,  271,   -1,
  260,   -1,   -1,  276,  277,   -1,   -1,   -1,   -1,   -1,
   -1,  284,  285,  273,  287,  288,  289,  290,    0,  292,
  293,   -1,   -1,   33,  297,  298,   -1,   -1,   59,   -1,
   -1,   -1,  305,  259,  260,  295,   -1,   -1,   -1,   -1,
   -1,  314,   -1,    0,  270,  271,   -1,   -1,   -1,   -1,
  276,  277,  278,   -1,   -1,   -1,   -1,  283,  284,  285,
   -1,  287,   -1,   -1,   -1,  291,  292,  293,   -1,   -1,
   -1,  297,  298,  257,   -1,  259,  260,   59,   -1,  305,
   -1,   -1,   -1,   -1,   -1,    0,  270,  271,  314,   -1,
   -1,   -1,  276,  277,   -1,  355,  356,   -1,   -1,   -1,
    0,  285,   59,  287,  288,  289,  290,   -1,  292,  293,
   -1,   -1,   -1,  297,  298,   -1,   -1,   -1,   -1,   -1,
  257,  305,  259,  260,   -1,    0,   -1,   -1,   -1,   -1,
  314,   -1,   -1,  270,  271,   -1,   -1,   -1,   -1,  276,
  277,   -1,   -1,   -1,   59,   -1,   -1,   -1,   -1,    0,
  287,  288,  289,  290,  291,  292,  293,   -1,   -1,   59,
  297,  298,  257,   -1,  259,  260,   -1,   -1,  305,   -1,
   -1,   -1,   -1,    0,   -1,  270,  271,  314,   -1,   -1,
   -1,  276,  277,   -1,   59,    0,   -1,   -1,   -1,  260,
   -1,   -1,  287,  288,  289,  290,   -1,  292,  293,  270,
  271,   -1,  297,  298,   -1,  276,  277,   -1,   59,   -1,
  305,   -1,  283,  284,  285,   -1,  287,   -1,   -1,  314,
  291,  292,  293,   -1,   -1,   -1,  297,  298,  259,  260,
   -1,   -1,   59,   -1,  305,   -1,   -1,   -1,   -1,  270,
  271,   -1,   -1,  314,   59,  276,  277,  257,   -1,  259,
   -1,   -1,   -1,  284,  285,   -1,  287,   -1,   -1,  269,
  291,  292,  293,   -1,   -1,   -1,  297,  298,   -1,   -1,
   -1,   -1,  282,   -1,  305,  257,   -1,  259,  260,   -1,
   -1,   -1,   -1,  314,   -1,  295,  296,   -1,  270,  271,
   -1,   -1,   -1,   -1,  276,  277,   -1,   -1,   -1,   -1,
   -1,   -1,  259,  260,   -1,  287,  288,  289,  290,   -1,
   -1,  293,   -1,  270,  271,  297,  298,   -1,   -1,  276,
  277,   -1,   -1,  305,   -1,   -1,   -1,   -1,  285,   -1,
  287,   -1,  314,   -1,  291,  292,  293,   -1,   -1,   -1,
  297,  298,  257,   -1,  259,  260,   -1,   -1,  305,   -1,
   -1,   -1,   -1,   -1,   -1,  270,  271,  314,   -1,  259,
  260,  276,  277,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
  270,  271,  287,  288,  289,  290,  276,  277,   -1,   -1,
   -1,   -1,  297,  298,  259,  260,   -1,  287,   -1,   -1,
  305,  291,  292,  293,   -1,  270,  271,  297,  298,  314,
   -1,  276,  277,   -1,   -1,  305,   -1,   -1,  259,  260,
   -1,   -1,  287,   -1,  314,   -1,   -1,  292,  293,  270,
  271,   -1,  297,  298,   -1,  276,  277,   -1,   -1,   -1,
  305,   -1,  259,  260,   -1,   -1,  287,   -1,   -1,  314,
   -1,   -1,  293,  270,  271,  260,  297,  298,   -1,  276,
  277,   -1,  103,   -1,  305,  270,  271,  108,   -1,   -1,
  287,  276,  277,  314,   -1,   -1,   -1,  118,   -1,   -1,
  297,  298,  287,   -1,   -1,   -1,   -1,   -1,  305,   -1,
   -1,   -1,  297,  298,  135,   -1,   -1,  314,   -1,   -1,
  305,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,  314,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,  160,
   -1,   -1,   -1,   -1,  165,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,  176,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,  216,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,  232,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,  258,   -1,   -1,
   -1,  262,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,  275,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
   -1,   -1,   -1,   -1,   -1,   -1,   -1,  298,
};
#define YYFINAL 3
#ifndef YYDEBUG
#define YYDEBUG 0
#endif
#define YYMAXTOKEN 314
#define YYUNDFTOKEN 404
#define YYTRANSLATE(a) ((a) > YYMAXTOKEN ? YYUNDFTOKEN : (a))
#if YYDEBUG
static const char *const ipnat_yyname[] = {

"end-of-file",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
"'!'",0,0,0,0,0,0,0,0,0,0,"','","'-'","'.'","'/'",0,0,0,0,0,0,0,0,0,0,"':'",
"';'",0,"'='",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"'{'",0,"'}'",0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,"YY_NUMBER","YY_HEX","YY_STR","YY_COMMENT","YY_CMP_EQ","YY_CMP_NE",
"YY_CMP_LE","YY_CMP_GE","YY_CMP_LT","YY_CMP_GT","YY_RANGE_OUT","YY_RANGE_IN",
"YY_IPV6","IPNY_MAPBLOCK","IPNY_RDR","IPNY_PORT","IPNY_PORTS","IPNY_AUTO",
"IPNY_RANGE","IPNY_MAP","IPNY_BIMAP","IPNY_FROM","IPNY_TO","IPNY_MASK",
"IPNY_PORTMAP","IPNY_ANY","IPNY_ROUNDROBIN","IPNY_FRAG","IPNY_AGE",
"IPNY_ICMPIDMAP","IPNY_PROXY","IPNY_TCP","IPNY_UDP","IPNY_TCPUDP","IPNY_STICKY",
"IPNY_MSSCLAMP","IPNY_TAG","IPNY_TLATE","IPNY_POOL","IPNY_HASH","IPNY_NO",
"IPNY_REWRITE","IPNY_PROTO","IPNY_ON","IPNY_SRC","IPNY_DST","IPNY_IN",
"IPNY_OUT","IPNY_DIVERT","IPNY_CONFIG","IPNY_ALLOW","IPNY_DENY","IPNY_DNS",
"IPNY_INET","IPNY_INET6","IPNY_SEQUENTIAL","IPNY_DSTLIST","IPNY_PURGE",0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,"illegal-symbol",
};
static const char *const ipnat_yyrule[] = {
"$accept : file",
"file : line",
"file : assign",
"file : file line",
"file : file assign",
"file : file pconf ';'",
"line : xx rule",
"line : YY_COMMENT",
"assign : YY_STR assigning YY_STR ';'",
"assigning : '='",
"xx :",
"rule : map eol",
"rule : mapblock eol",
"rule : redir eol",
"rule : rewrite ';'",
"rule : divert ';'",
"no : IPNY_NO",
"eol :",
"eol : ';'",
"map : mapit ifnames addr tlate rhsaddr proxy mapoptions",
"map : mapit ifnames addr tlate rhsaddr mapport mapoptions",
"map : no mapit ifnames addr setproto ';'",
"map : mapit ifnames mapfrom tlate rhsaddr proxy mapoptions",
"map : no mapit ifnames mapfrom setproto ';'",
"map : mapit ifnames mapfrom tlate rhsaddr mapport mapoptions",
"mapblock : mapblockit ifnames addr tlate addr ports mapoptions",
"$$1 :",
"mapblock : no mapblockit ifnames $$1 addr setproto ';'",
"redir : rdrit ifnames addr dport tlate dip nport setproto rdroptions",
"redir : no rdrit ifnames addr dport setproto ';'",
"redir : rdrit ifnames rdrfrom tlate dip nport setproto rdroptions",
"redir : no rdrit ifnames rdrfrom setproto ';'",
"rewrite : IPNY_REWRITE oninout rwrproto mapfrom tlate newdst newopts",
"divert : IPNY_DIVERT oninout rwrproto mapfrom tlate divdst newopts",
"tlate : IPNY_TLATE",
"$$2 :",
"$$3 :",
"pconf : IPNY_PROXY $$2 IPNY_DNS '/' proto IPNY_CONFIG YY_STR '{' $$3 dnslines ';' '}'",
"dnslines : dnsline",
"dnslines : dnslines ';' dnsline",
"dnsline : IPNY_ALLOW YY_STR",
"dnsline : IPNY_DENY YY_STR",
"dnsline : IPNY_ALLOW '.' YY_STR",
"dnsline : IPNY_DENY '.' YY_STR",
"oninout : inout IPNY_ON ifnames",
"inout : IPNY_IN",
"inout : IPNY_OUT",
"rwrproto :",
"rwrproto : IPNY_PROTO setproto",
"newdst : src rhsaddr srcports dst erhdaddr dstports",
"divdst : src addr ',' portspec dst addr ',' portspec IPNY_UDP",
"src : IPNY_SRC",
"dst : IPNY_DST",
"srcports : comaports",
"srcports : IPNY_PORT '=' portspec",
"dstports : comaports",
"dstports : IPNY_PORT '=' portspec",
"comaports :",
"$$4 :",
"comaports : ',' $$4 portpair",
"proxy :",
"proxy : IPNY_PROXY port portspec YY_STR '/' proto",
"proxy : IPNY_PROXY port YY_STR YY_STR '/' proto",
"proxy : IPNY_PROXY port portspec YY_STR '/' proto IPNY_CONFIG YY_STR",
"proxy : IPNY_PROXY port YY_STR YY_STR '/' proto IPNY_CONFIG YY_STR",
"setproto :",
"setproto : proto",
"setproto : IPNY_TCPUDP",
"setproto : IPNY_TCP '/' IPNY_UDP",
"rhsaddr : addr",
"$$5 :",
"rhsaddr : hostname '-' $$5 hostname",
"$$6 :",
"rhsaddr : IPNY_RANGE hostname '-' $$6 hostname",
"$$7 :",
"dip : hostname ',' $$7 hostname",
"dip : rhdaddr",
"rhdaddr : addr",
"rhdaddr : hostname '-' hostname",
"rhdaddr : IPNY_RANGE hostname '-' hostname",
"erhdaddr : rhdaddr",
"erhdaddr : IPNY_DSTLIST '/' YY_NUMBER",
"erhdaddr : IPNY_DSTLIST '/' YY_STR",
"port : IPNY_PORT",
"portspec : YY_NUMBER",
"portspec : YY_STR",
"portpair : portspec",
"portpair : portspec '-' portspec",
"portpair : portspec ':' portspec",
"dport :",
"dport : port portpair",
"nport :",
"nport : port portpair",
"nport : port '=' portspec",
"ports :",
"ports : IPNY_PORTS YY_NUMBER",
"ports : IPNY_PORTS IPNY_AUTO",
"mapit : IPNY_MAP",
"mapit : IPNY_BIMAP",
"rdrit : IPNY_RDR",
"mapblockit : IPNY_MAPBLOCK",
"mapfrom : from sobject to dobject",
"mapfrom : from sobject '!' to dobject",
"mapfrom : from sobject to '!' dobject",
"rdrfrom : from sobject to dobject",
"rdrfrom : '!' from sobject to dobject",
"rdrfrom : from '!' sobject to dobject",
"from : IPNY_FROM",
"to : IPNY_TO",
"ifnames : ifname family",
"ifnames : ifname ',' otherifname family",
"ifname : YY_STR",
"family :",
"family : IPNY_INET",
"family : IPNY_INET6",
"otherifname : YY_STR",
"mapport : IPNY_PORTMAP tcpudp portpair sequential",
"mapport : IPNY_PORTMAP portpair tcpudp sequential",
"mapport : IPNY_PORTMAP tcpudp IPNY_AUTO sequential",
"mapport : IPNY_ICMPIDMAP YY_STR portpair sequential",
"sobject : saddr",
"sobject : saddr port portstuff",
"saddr : addr",
"dobject : daddr",
"dobject : daddr port portstuff",
"daddr : addr",
"addr : IPNY_ANY",
"addr : hostname",
"addr : hostname slash YY_NUMBER",
"addr : hostname slash ipaddr",
"addr : hostname slash hexnumber",
"addr : hostname mask ipaddr",
"addr : hostname mask hexnumber",
"addr : pool slash YY_NUMBER",
"addr : pool slash YY_STR",
"addr : hash slash YY_NUMBER",
"addr : hash slash YY_STR",
"slash : '/'",
"mask : IPNY_MASK",
"pool : IPNY_POOL",
"hash : IPNY_HASH",
"portstuff : compare portspec",
"portstuff : portspec range portspec",
"mapoptions : rr frag age mssclamp nattag setproto purge",
"rdroptions : rr frag age sticky mssclamp rdrproxy nattag purge",
"nattag :",
"nattag : IPNY_TAG YY_STR",
"rr :",
"rr : IPNY_ROUNDROBIN",
"frag :",
"frag : IPNY_FRAG",
"age :",
"age : IPNY_AGE YY_NUMBER",
"age : IPNY_AGE YY_NUMBER '/' YY_NUMBER",
"sticky :",
"sticky : IPNY_STICKY",
"mssclamp :",
"mssclamp : IPNY_MSSCLAMP YY_NUMBER",
"tcpudp : IPNY_TCP",
"tcpudp : IPNY_UDP",
"tcpudp : IPNY_TCPUDP",
"tcpudp : IPNY_TCP '/' IPNY_UDP",
"sequential :",
"sequential : IPNY_SEQUENTIAL",
"purge :",
"purge : IPNY_PURGE",
"rdrproxy : IPNY_PROXY YY_STR",
"rdrproxy : proxy",
"newopts :",
"newopts : IPNY_PURGE",
"proto : YY_NUMBER",
"proto : IPNY_TCP",
"proto : IPNY_UDP",
"proto : YY_STR",
"hexnumber : YY_HEX",
"hostname : YY_STR",
"hostname : YY_NUMBER",
"hostname : ipv4",
"hostname : YY_IPV6",
"hostname : YY_NUMBER YY_IPV6",
"compare : '='",
"compare : YY_CMP_EQ",
"compare : YY_CMP_NE",
"compare : YY_CMP_LT",
"compare : YY_CMP_LE",
"compare : YY_CMP_GT",
"compare : YY_CMP_GE",
"range : YY_RANGE_OUT",
"range : YY_RANGE_IN",
"range : ':'",
"ipaddr : ipv4",
"ipaddr : YY_IPV6",
"ipv4 : YY_NUMBER '.' YY_NUMBER '.' YY_NUMBER '.' YY_NUMBER",

};
#endif

int      ipnat_yydebug;
int      ipnat_yynerrs;

int      ipnat_yyerrflag;
int      ipnat_yychar;
YYSTYPE  ipnat_yyval;
YYSTYPE  ipnat_yylval;

/* define the initial stack-sizes */
#ifdef YYSTACKSIZE
#undef YYMAXDEPTH
#define YYMAXDEPTH  YYSTACKSIZE
#else
#ifdef YYMAXDEPTH
#define YYSTACKSIZE YYMAXDEPTH
#else
#define YYSTACKSIZE 10000
#define YYMAXDEPTH  10000
#endif
#endif

#define YYINITSTACKSIZE 200

typedef struct {
    unsigned stacksize;
    YYINT    *s_base;
    YYINT    *s_mark;
    YYINT    *s_last;
    YYSTYPE  *l_base;
    YYSTYPE  *l_mark;
} YYSTACKDATA;
/* variables for the parser stack */
static YYSTACKDATA ipnat_yystack;
#line 1235 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"


static	wordtab_t	proxies[] = {
	{ "dns",	IPNY_DNS }
};

static	wordtab_t	dnswords[] = {
	{ "allow",	IPNY_ALLOW },
	{ "block",	IPNY_DENY },
	{ "deny",	IPNY_DENY },
	{ "drop",	IPNY_DENY },
	{ "pass",	IPNY_ALLOW },

};

static	wordtab_t	ipnat_yywords[] = {
	{ "age",	IPNY_AGE },
	{ "any",	IPNY_ANY },
	{ "auto",	IPNY_AUTO },
	{ "bimap",	IPNY_BIMAP },
	{ "config",	IPNY_CONFIG },
	{ "divert",	IPNY_DIVERT },
	{ "dst",	IPNY_DST },
	{ "dstlist",	IPNY_DSTLIST },
	{ "frag",	IPNY_FRAG },
	{ "from",	IPNY_FROM },
	{ "hash",	IPNY_HASH },
	{ "icmpidmap",	IPNY_ICMPIDMAP },
	{ "in",		IPNY_IN },
	{ "inet",	IPNY_INET },
	{ "inet6",	IPNY_INET6 },
	{ "mask",	IPNY_MASK },
	{ "map",	IPNY_MAP },
	{ "map-block",	IPNY_MAPBLOCK },
	{ "mssclamp",	IPNY_MSSCLAMP },
	{ "netmask",	IPNY_MASK },
	{ "no",		IPNY_NO },
	{ "on",		IPNY_ON },
	{ "out",	IPNY_OUT },
	{ "pool",	IPNY_POOL },
	{ "port",	IPNY_PORT },
	{ "portmap",	IPNY_PORTMAP },
	{ "ports",	IPNY_PORTS },
	{ "proto",	IPNY_PROTO },
	{ "proxy",	IPNY_PROXY },
	{ "purge",	IPNY_PURGE },
	{ "range",	IPNY_RANGE },
	{ "rewrite",	IPNY_REWRITE },
	{ "rdr",	IPNY_RDR },
	{ "round-robin",IPNY_ROUNDROBIN },
	{ "sequential",	IPNY_SEQUENTIAL },
	{ "src",	IPNY_SRC },
	{ "sticky",	IPNY_STICKY },
	{ "tag",	IPNY_TAG },
	{ "tcp",	IPNY_TCP },
	{ "tcpudp",	IPNY_TCPUDP },
	{ "to",		IPNY_TO },
	{ "udp",	IPNY_UDP },
	{ "-",		'-' },
	{ "->",		IPNY_TLATE },
	{ "eq",		YY_CMP_EQ },
	{ "ne",		YY_CMP_NE },
	{ "lt",		YY_CMP_LT },
	{ "gt",		YY_CMP_GT },
	{ "le",		YY_CMP_LE },
	{ "ge",		YY_CMP_GE },
	{ NULL,		0 }
};


int
ipnat_parsefile(fd, addfunc, ioctlfunc, filename)
	int fd;
	addfunc_t addfunc;
	ioctlfunc_t ioctlfunc;
	char *filename;
{
	FILE *fp = NULL;
	int rval;
	char *s;

	ipnat_yylineNum = 1;

	(void) ipnat_yysettab(ipnat_yywords);

	s = getenv("YYDEBUG");
	if (s)
		ipnat_yydebug = atoi(s);
	else
		ipnat_yydebug = 0;

	if (strcmp(filename, "-")) {
		fp = fopen(filename, "r");
		if (!fp) {
			FPRINTF(stderr, "fopen(%s) failed: %s\n", filename,
				STRERROR(errno));
			return -1;
		}
	} else
		fp = stdin;

	while ((rval = ipnat_parsesome(fd, addfunc, ioctlfunc, fp)) == 0)
		;
	if (fp != NULL)
		fclose(fp);
	if (rval == -1)
		rval = 0;
	else if (rval != 0)
		rval = 1;
	return rval;
}


int
ipnat_parsesome(fd, addfunc, ioctlfunc, fp)
	int fd;
	addfunc_t addfunc;
	ioctlfunc_t ioctlfunc;
	FILE *fp;
{
	char *s;
	int i;

	natfd = fd;
	parser_error = 0;
	nataddfunc = addfunc;
	natioctlfunc = ioctlfunc;

	if (feof(fp))
		return -1;
	i = fgetc(fp);
	if (i == EOF)
		return -1;
	if (ungetc(i, fp) == EOF)
		return -1;
	if (feof(fp))
		return -1;
	s = getenv("YYDEBUG");
	if (s)
		ipnat_yydebug = atoi(s);
	else
		ipnat_yydebug = 0;

	ipnat_yyin = fp;
	ipnat_yyparse();
	return parser_error;
}


static void
newnatrule()
{
	ipnat_t *n;

	n = calloc(1, sizeof(*n));
	if (n == NULL)
		return;

	if (nat == NULL) {
		nattop = nat = n;
		n->in_pnext = &nattop;
	} else {
		nat->in_next = n;
		n->in_pnext = &nat->in_next;
		nat = n;
	}

	n->in_flineno = ipnat_yylineNum;
	n->in_ifnames[0] = -1;
	n->in_ifnames[1] = -1;
	n->in_plabel = -1;
	n->in_pconfig = -1;
	n->in_size = sizeof(*n);

	suggest_port = 0;
}


static void
setnatproto(p)
	int p;
{
	nat->in_pr[0] = p;
	nat->in_pr[1] = p;

	switch (p)
	{
	case IPPROTO_TCP :
		nat->in_flags |= IPN_TCP;
		nat->in_flags &= ~IPN_UDP;
		break;
	case IPPROTO_UDP :
		nat->in_flags |= IPN_UDP;
		nat->in_flags &= ~IPN_TCP;
		break;
#ifdef USE_INET6
	case IPPROTO_ICMPV6 :
#endif
	case IPPROTO_ICMP :
		nat->in_flags &= ~IPN_TCPUDP;
		if (!(nat->in_flags & IPN_ICMPQUERY) &&
		    !(nat->in_redir & NAT_DIVERTUDP)) {
			nat->in_dcmp = 0;
			nat->in_scmp = 0;
			nat->in_dpmin = 0;
			nat->in_dpmax = 0;
			nat->in_dpnext = 0;
			nat->in_spmin = 0;
			nat->in_spmax = 0;
			nat->in_spnext = 0;
		}
		break;
	default :
		if ((nat->in_redir & NAT_MAPBLK) == 0) {
			nat->in_flags &= ~IPN_TCPUDP;
			nat->in_dcmp = 0;
			nat->in_scmp = 0;
			nat->in_dpmin = 0;
			nat->in_dpmax = 0;
			nat->in_dpnext = 0;
			nat->in_spmin = 0;
			nat->in_spmax = 0;
			nat->in_spnext = 0;
		}
		break;
	}

	if ((nat->in_flags & (IPN_TCP|IPN_UDP)) == 0) {
		nat->in_stop = 0;
		nat->in_dtop = 0;
		nat->in_osport = 0;
		nat->in_odport = 0;
		nat->in_stop = 0;
		nat->in_osport = 0;
		nat->in_dtop = 0;
		nat->in_odport = 0;
	}
	if ((nat->in_flags & (IPN_TCPUDP|IPN_FIXEDDPORT)) == IPN_FIXEDDPORT)
		nat->in_flags &= ~IPN_FIXEDDPORT;
}


int
ipnat_addrule(fd, ioctlfunc, ptr)
	int fd;
	ioctlfunc_t ioctlfunc;
	void *ptr;
{
	ioctlcmd_t add, del;
	ipfobj_t obj;
	ipnat_t *ipn;

	ipn = ptr;
	bzero((char *)&obj, sizeof(obj));
	obj.ipfo_rev = IPFILTER_VERSION;
	obj.ipfo_size = ipn->in_size;
	obj.ipfo_type = IPFOBJ_IPNAT;
	obj.ipfo_ptr = ptr;

	if ((opts & OPT_DONOTHING) != 0)
		fd = -1;

	if (opts & OPT_ZERORULEST) {
		add = SIOCZRLST;
		del = 0;
	} else if (opts & OPT_PURGE) {
		add = 0;
		del = SIOCPURGENAT;
	} else {
		add = SIOCADNAT;
		del = SIOCRMNAT;
	}

	if ((opts & OPT_VERBOSE) != 0)
		printnat(ipn, opts);

	if (opts & OPT_DEBUG)
		binprint(ipn, ipn->in_size);

	if ((opts & OPT_ZERORULEST) != 0) {
		if ((*ioctlfunc)(fd, add, (void *)&obj) == -1) {
			if ((opts & OPT_DONOTHING) == 0) {
				char msg[80];

				sprintf(msg, "%d:ioctl(zero nat rule)",
					ipn->in_flineno);
				return ipf_perror_fd(fd, ioctlfunc, msg);
			}
		} else {
			PRINTF("hits %lu ", ipn->in_hits);
#ifdef USE_QUAD_T
			PRINTF("bytes %"PRIu64" ",
			       ipn->in_bytes[0] + ipn->in_bytes[1]);
#else
			PRINTF("bytes %lu ",
			       ipn->in_bytes[0] + ipn->in_bytes[1]);
#endif
			printnat(ipn, opts);
		}
	} else if ((opts & OPT_REMOVE) != 0) {
		if ((*ioctlfunc)(fd, del, (void *)&obj) == -1) {
			if ((opts & OPT_DONOTHING) == 0) {
				char msg[80];

				sprintf(msg, "%d:ioctl(delete nat rule)",
					ipn->in_flineno);
				return ipf_perror_fd(fd, ioctlfunc, msg);
			}
		}
	} else {
		if ((*ioctlfunc)(fd, add, (void *)&obj) == -1) {
			if ((opts & OPT_DONOTHING) == 0) {
				char msg[80];

				sprintf(msg, "%d:ioctl(add/insert nat rule)",
					ipn->in_flineno);
				if (errno == EEXIST) {
					sprintf(msg + strlen(msg), "(line %d)",
						ipn->in_flineno);
				}
				return ipf_perror_fd(fd, ioctlfunc, msg);
			}
		}
	}
	return 0;
}


static void
setmapifnames()
{
	if (nat->in_ifnames[1] == -1)
		nat->in_ifnames[1] = nat->in_ifnames[0];

	if ((suggest_port == 1) && (nat->in_flags & IPN_TCPUDP) == 0)
		nat->in_flags |= IPN_TCPUDP;

	if ((nat->in_flags & IPN_TCPUDP) == 0)
		setnatproto(nat->in_pr[1]);

	if (((nat->in_redir & NAT_MAPBLK) != 0) ||
	      ((nat->in_flags & IPN_AUTOPORTMAP) != 0))
		nat_setgroupmap(nat);
}


static void
setrdrifnames()
{
	if ((suggest_port == 1) && (nat->in_flags & IPN_TCPUDP) == 0)
		nat->in_flags |= IPN_TCPUDP;

	if ((nat->in_pr[0] == 0) && ((nat->in_flags & IPN_TCPUDP) == 0) &&
	    (nat->in_dpmin != 0 || nat->in_dpmax != 0 || nat->in_dpnext != 0))
		setnatproto(IPPROTO_TCP);

	if (nat->in_ifnames[1] == -1)
		nat->in_ifnames[1] = nat->in_ifnames[0];
}


static void
proxy_setconfig(proxy)
	int proxy;
{
	if (proxy == IPNY_DNS) {
		ipnat_yysetfixeddict(dnswords);
	}
}


static void
proxy_unsetconfig()
{
	ipnat_yyresetdict();
}


static namelist_t *
proxy_dns_add_pass(prefix, name)
	char *prefix, *name;
{
	namelist_t *n;

	n = calloc(1, sizeof(*n));
	if (n != NULL) {
		if (prefix == NULL || *prefix == '\0') {
			n->na_name = strdup(name);
		} else {
			n->na_name = malloc(strlen(name) + strlen(prefix) + 1);
			strcpy(n->na_name, prefix);
			strcat(n->na_name, name);
		}
	}
	return n;
}


static namelist_t *
proxy_dns_add_block(prefix, name)
	char *prefix, *name;
{
	namelist_t *n;

	n = calloc(1, sizeof(*n));
	if (n != NULL) {
		if (prefix == NULL || *prefix == '\0') {
			n->na_name = strdup(name);
		} else {
			n->na_name = malloc(strlen(name) + strlen(prefix) + 1);
			strcpy(n->na_name, prefix);
			strcat(n->na_name, name);
		}
		n->na_value = 1;
	}
	return n;
}


static void
proxy_addconfig(proxy, proto, conf, list)
	char *proxy, *conf;
	int proto;
	namelist_t *list;
{
	proxyrule_t *pr;

	pr = calloc(1, sizeof(*pr));
	if (pr != NULL) {
		pr->pr_proto = proto;
		pr->pr_proxy = proxy;
		pr->pr_conf = conf;
		pr->pr_names = list;
		pr->pr_next = prules;
		prules = pr;
	}
}


static void
proxy_loadrules(fd, ioctlfunc, rules)
	int fd;
	ioctlfunc_t ioctlfunc;
	proxyrule_t *rules;
{
	proxyrule_t *pr;

	while ((pr = rules) != NULL) {
		proxy_loadconfig(fd, ioctlfunc, pr->pr_proxy, pr->pr_proto,
				 pr->pr_conf, pr->pr_names);
		rules = pr->pr_next;
		free(pr->pr_conf);
		free(pr);
	}
}


static void
proxy_loadconfig(fd, ioctlfunc, proxy, proto, conf, list)
	int fd;
	ioctlfunc_t ioctlfunc;
	char *proxy, *conf;
	int proto;
	namelist_t *list;
{
	namelist_t *na;
	ipfobj_t obj;
	ap_ctl_t pcmd;

	obj.ipfo_rev = IPFILTER_VERSION;
	obj.ipfo_type = IPFOBJ_PROXYCTL;
	obj.ipfo_size = sizeof(pcmd);
	obj.ipfo_ptr = &pcmd;

	while ((na = list) != NULL) {
		if ((opts & OPT_REMOVE) != 0)
			pcmd.apc_cmd = APC_CMD_DEL;
		else
			pcmd.apc_cmd = APC_CMD_ADD;
		pcmd.apc_dsize = strlen(na->na_name) + 1;
		pcmd.apc_data = na->na_name;
		pcmd.apc_arg = na->na_value;
		pcmd.apc_p = proto;

		strncpy(pcmd.apc_label, proxy, APR_LABELLEN);
		pcmd.apc_label[APR_LABELLEN - 1] = '\0';

		strncpy(pcmd.apc_config, conf, APR_LABELLEN);
		pcmd.apc_config[APR_LABELLEN - 1] = '\0';

		if ((*ioctlfunc)(fd, SIOCPROXY, (void *)&obj) == -1) {
                        if ((opts & OPT_DONOTHING) == 0) {
                                char msg[80];

                                sprintf(msg, "%d:ioctl(add/remove proxy rule)",
					ipnat_yylineNum);
                                ipf_perror_fd(fd, ioctlfunc, msg);
				return;
                        }
		}

		list = na->na_next;
		free(na->na_name);
		free(na);
	}
}


static void
setifname(np, idx, name)
	ipnat_t **np;
	int idx;
	char *name;
{
	int pos;

	pos = addname(np, name);
	if (pos == -1)
		return;
	(*np)->in_ifnames[idx] = pos;
}


static int
addname(np, name)
	ipnat_t **np;
	char *name;
{
	ipnat_t *n;
	int nlen;
	int pos;

	nlen = strlen(name) + 1;
	n = realloc(*np, (*np)->in_size + nlen);
	if (*np == nattop)
		nattop = n;
	*np = n;
	if (n == NULL)
		return -1;
	if (n->in_pnext != NULL)
		*n->in_pnext = n;
	n->in_size += nlen;
	pos = n->in_namelen;
	n->in_namelen += nlen;
	strcpy(n->in_names + pos, name);
	n->in_names[n->in_namelen] = '\0';
	return pos;
}
#line 1537 "ipnat_y.c"

#if YYDEBUG
#include <stdio.h>		/* needed for printf */
#endif

#include <stdlib.h>	/* needed for malloc, etc */
#include <string.h>	/* needed for memset */

/* allocate initial stack or double stack size, up to YYMAXDEPTH */
static int ipnat_yygrowstack(YYSTACKDATA *data)
{
    int i;
    unsigned newsize;
    YYINT *newss;
    YYSTYPE *newvs;

    if ((newsize = data->stacksize) == 0)
        newsize = YYINITSTACKSIZE;
    else if (newsize >= YYMAXDEPTH)
        return YYENOMEM;
    else if ((newsize *= 2) > YYMAXDEPTH)
        newsize = YYMAXDEPTH;

    i = (int) (data->s_mark - data->s_base);
    newss = (YYINT *)realloc(data->s_base, newsize * sizeof(*newss));
    if (newss == 0)
        return YYENOMEM;

    data->s_base = newss;
    data->s_mark = newss + i;

    newvs = (YYSTYPE *)realloc(data->l_base, newsize * sizeof(*newvs));
    if (newvs == 0)
        return YYENOMEM;

    data->l_base = newvs;
    data->l_mark = newvs + i;

    data->stacksize = newsize;
    data->s_last = data->s_base + newsize - 1;
    return 0;
}

#if YYPURE || defined(YY_NO_LEAKS)
static void ipnat_yyfreestack(YYSTACKDATA *data)
{
    free(data->s_base);
    free(data->l_base);
    memset(data, 0, sizeof(*data));
}
#else
#define ipnat_yyfreestack(data) /* nothing */
#endif

#define YYABORT  goto ipnat_yyabort
#define YYREJECT goto ipnat_yyabort
#define YYACCEPT goto ipnat_yyaccept
#define YYERROR  goto ipnat_yyerrlab

int
YYPARSE_DECL()
{
    int ipnat_yym, ipnat_yyn, ipnat_yystate;
#if YYDEBUG
    const char *ipnat_yys;

    if ((ipnat_yys = getenv("YYDEBUG")) != 0)
    {
        ipnat_yyn = *ipnat_yys;
        if (ipnat_yyn >= '0' && ipnat_yyn <= '9')
            ipnat_yydebug = ipnat_yyn - '0';
    }
#endif

    ipnat_yynerrs = 0;
    ipnat_yyerrflag = 0;
    ipnat_yychar = YYEMPTY;
    ipnat_yystate = 0;

#if YYPURE
    memset(&ipnat_yystack, 0, sizeof(ipnat_yystack));
#endif

    if (ipnat_yystack.s_base == NULL && ipnat_yygrowstack(&ipnat_yystack) == YYENOMEM) goto ipnat_yyoverflow;
    ipnat_yystack.s_mark = ipnat_yystack.s_base;
    ipnat_yystack.l_mark = ipnat_yystack.l_base;
    ipnat_yystate = 0;
    *ipnat_yystack.s_mark = 0;

ipnat_yyloop:
    if ((ipnat_yyn = ipnat_yydefred[ipnat_yystate]) != 0) goto ipnat_yyreduce;
    if (ipnat_yychar < 0)
    {
        if ((ipnat_yychar = YYLEX) < 0) ipnat_yychar = YYEOF;
#if YYDEBUG
        if (ipnat_yydebug)
        {
            ipnat_yys = ipnat_yyname[YYTRANSLATE(ipnat_yychar)];
            printf("%sdebug: state %d, reading %d (%s)\n",
                    YYPREFIX, ipnat_yystate, ipnat_yychar, ipnat_yys);
        }
#endif
    }
    if ((ipnat_yyn = ipnat_yysindex[ipnat_yystate]) && (ipnat_yyn += ipnat_yychar) >= 0 &&
            ipnat_yyn <= YYTABLESIZE && ipnat_yycheck[ipnat_yyn] == ipnat_yychar)
    {
#if YYDEBUG
        if (ipnat_yydebug)
            printf("%sdebug: state %d, shifting to state %d\n",
                    YYPREFIX, ipnat_yystate, ipnat_yytable[ipnat_yyn]);
#endif
        if (ipnat_yystack.s_mark >= ipnat_yystack.s_last && ipnat_yygrowstack(&ipnat_yystack) == YYENOMEM)
        {
            goto ipnat_yyoverflow;
        }
        ipnat_yystate = ipnat_yytable[ipnat_yyn];
        *++ipnat_yystack.s_mark = ipnat_yytable[ipnat_yyn];
        *++ipnat_yystack.l_mark = ipnat_yylval;
        ipnat_yychar = YYEMPTY;
        if (ipnat_yyerrflag > 0)  --ipnat_yyerrflag;
        goto ipnat_yyloop;
    }
    if ((ipnat_yyn = ipnat_yyrindex[ipnat_yystate]) && (ipnat_yyn += ipnat_yychar) >= 0 &&
            ipnat_yyn <= YYTABLESIZE && ipnat_yycheck[ipnat_yyn] == ipnat_yychar)
    {
        ipnat_yyn = ipnat_yytable[ipnat_yyn];
        goto ipnat_yyreduce;
    }
    if (ipnat_yyerrflag) goto ipnat_yyinrecovery;

    YYERROR_CALL("syntax error");

    goto ipnat_yyerrlab;

ipnat_yyerrlab:
    ++ipnat_yynerrs;

ipnat_yyinrecovery:
    if (ipnat_yyerrflag < 3)
    {
        ipnat_yyerrflag = 3;
        for (;;)
        {
            if ((ipnat_yyn = ipnat_yysindex[*ipnat_yystack.s_mark]) && (ipnat_yyn += YYERRCODE) >= 0 &&
                    ipnat_yyn <= YYTABLESIZE && ipnat_yycheck[ipnat_yyn] == YYERRCODE)
            {
#if YYDEBUG
                if (ipnat_yydebug)
                    printf("%sdebug: state %d, error recovery shifting\
 to state %d\n", YYPREFIX, *ipnat_yystack.s_mark, ipnat_yytable[ipnat_yyn]);
#endif
                if (ipnat_yystack.s_mark >= ipnat_yystack.s_last && ipnat_yygrowstack(&ipnat_yystack) == YYENOMEM)
                {
                    goto ipnat_yyoverflow;
                }
                ipnat_yystate = ipnat_yytable[ipnat_yyn];
                *++ipnat_yystack.s_mark = ipnat_yytable[ipnat_yyn];
                *++ipnat_yystack.l_mark = ipnat_yylval;
                goto ipnat_yyloop;
            }
            else
            {
#if YYDEBUG
                if (ipnat_yydebug)
                    printf("%sdebug: error recovery discarding state %d\n",
                            YYPREFIX, *ipnat_yystack.s_mark);
#endif
                if (ipnat_yystack.s_mark <= ipnat_yystack.s_base) goto ipnat_yyabort;
                --ipnat_yystack.s_mark;
                --ipnat_yystack.l_mark;
            }
        }
    }
    else
    {
        if (ipnat_yychar == YYEOF) goto ipnat_yyabort;
#if YYDEBUG
        if (ipnat_yydebug)
        {
            ipnat_yys = ipnat_yyname[YYTRANSLATE(ipnat_yychar)];
            printf("%sdebug: state %d, error recovery discards token %d (%s)\n",
                    YYPREFIX, ipnat_yystate, ipnat_yychar, ipnat_yys);
        }
#endif
        ipnat_yychar = YYEMPTY;
        goto ipnat_yyloop;
    }

ipnat_yyreduce:
#if YYDEBUG
    if (ipnat_yydebug)
        printf("%sdebug: state %d, reducing by rule %d (%s)\n",
                YYPREFIX, ipnat_yystate, ipnat_yyn, ipnat_yyrule[ipnat_yyn]);
#endif
    ipnat_yym = ipnat_yylen[ipnat_yyn];
    if (ipnat_yym)
        ipnat_yyval = ipnat_yystack.l_mark[1-ipnat_yym];
    else
        memset(&ipnat_yyval, 0, sizeof ipnat_yyval);
    switch (ipnat_yyn)
    {
case 6:
#line 139 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int err;
			  while ((nat = nattop) != NULL) {
				if (nat->in_v[0] == 0)
					nat->in_v[0] = 4;
				if (nat->in_v[1] == 0)
					nat->in_v[1] = nat->in_v[0];
				nattop = nat->in_next;
				err = (*nataddfunc)(natfd, natioctlfunc, nat);
				free(nat);
				if (err != 0) {
					parser_error = err;
					break;
				}
			  }
			  if (parser_error == 0 && prules != NULL) {
				proxy_loadrules(natfd, natioctlfunc, prules);
				prules = NULL;
			  }
			  resetlexer();
			}
break;
case 8:
#line 162 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ set_variable(ipnat_yystack.l_mark[-3].str, ipnat_yystack.l_mark[-1].str);
					  resetlexer();
					  free(ipnat_yystack.l_mark[-3].str);
					  free(ipnat_yystack.l_mark[-1].str);
					  ipnat_yyvarnext = 0;
					}
break;
case 9:
#line 171 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyvarnext = 1; }
break;
case 10:
#line 174 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ newnatrule(); }
break;
case 16:
#line 184 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_NO; }
break;
case 19:
#line 191 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-4].ipp.f != 0 && ipnat_yystack.l_mark[-4].ipp.f != ipnat_yystack.l_mark[-2].ipp.f && ipnat_yystack.l_mark[-2].ipp.f != 0)
					ipnat_yyerror("3.address family mismatch");
				  if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-4].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-4].ipp.v;
				  if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-4].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-4].ipp.v;
				  nat->in_osrcatype = ipnat_yystack.l_mark[-4].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-4].ipp.a, &nat->in_osrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-4].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-4].ipp.m, &nat->in_osrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-4].ipp.a));
				  nat->in_nsrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  nat->in_nsrcafunc = ipnat_yystack.l_mark[-2].ipp.u;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_nsrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_nsrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 20:
#line 216 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-4].ipp.f != ipnat_yystack.l_mark[-2].ipp.f && ipnat_yystack.l_mark[-4].ipp.f != 0 && ipnat_yystack.l_mark[-2].ipp.f != 0)
					ipnat_yyerror("4.address family mismatch");
				  if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-4].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-4].ipp.v;
				  if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-4].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-4].ipp.v;
				  nat->in_osrcatype = ipnat_yystack.l_mark[-4].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-4].ipp.a, &nat->in_osrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-4].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-4].ipp.m, &nat->in_osrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-4].ipp.a));
				  nat->in_nsrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  nat->in_nsrcafunc = ipnat_yystack.l_mark[-2].ipp.u;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_nsrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_nsrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 21:
#line 241 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_v[0] == 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  nat->in_osrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_osrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_osrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 22:
#line 252 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-4].num != 0 && ipnat_yystack.l_mark[-2].ipp.f != 0 && ipnat_yystack.l_mark[-4].num != ipnat_yystack.l_mark[-2].ipp.f)
					ipnat_yyerror("5.address family mismatch");
				  if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-4].num != 0)
					nat->in_v[0] = ftov(ipnat_yystack.l_mark[-4].num);
				  if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-4].num != 0)
					nat->in_v[1] = ftov(ipnat_yystack.l_mark[-4].num);
				  nat->in_nsrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  nat->in_nsrcafunc = ipnat_yystack.l_mark[-2].ipp.u;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_nsrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_nsrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 23:
#line 272 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_v[0] = ftov(ipnat_yystack.l_mark[-2].num);
				  setmapifnames();
				}
break;
case 24:
#line 276 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-4].num != 0 && ipnat_yystack.l_mark[-2].ipp.f != 0 && ipnat_yystack.l_mark[-4].num != ipnat_yystack.l_mark[-2].ipp.f)
					ipnat_yyerror("6.address family mismatch");
				  if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-4].num != 0)
					nat->in_v[0] = ftov(ipnat_yystack.l_mark[-4].num);
				  if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-4].num != 0)
					nat->in_v[1] = ftov(ipnat_yystack.l_mark[-4].num);
				  nat->in_nsrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  nat->in_nsrcafunc = ipnat_yystack.l_mark[-2].ipp.u;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_nsrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_nsrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 25:
#line 299 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-4].ipp.f != 0 && ipnat_yystack.l_mark[-2].ipp.f != 0 && ipnat_yystack.l_mark[-4].ipp.f != ipnat_yystack.l_mark[-2].ipp.f)
					ipnat_yyerror("7.address family mismatch");
				  if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[0] == 0 && ipnat_yystack.l_mark[-4].ipp.v != 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-4].ipp.v;
				  if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-2].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-2].ipp.v;
				  else if (nat->in_v[1] == 0 && ipnat_yystack.l_mark[-4].ipp.v != 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-4].ipp.v;
				  nat->in_osrcatype = ipnat_yystack.l_mark[-4].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-4].ipp.a, &nat->in_osrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-4].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-4].ipp.m, &nat->in_osrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-4].ipp.a));
				  nat->in_nsrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  nat->in_nsrcafunc = ipnat_yystack.l_mark[-2].ipp.u;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_nsrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_nsrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 26:
#line 323 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 27:
#line 324 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_v[0] == 0)
					nat->in_v[0] = ipnat_yystack.l_mark[-2].ipp.v;
				  if (nat->in_v[1] == 0)
					nat->in_v[1] = ipnat_yystack.l_mark[-2].ipp.v;
				  nat->in_osrcatype = ipnat_yystack.l_mark[-2].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.a, &nat->in_osrc.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-2].ipp.m, &nat->in_osrc.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-2].ipp.a));

				  setmapifnames();
				}
break;
case 28:
#line 339 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-3].num != 0 && ipnat_yystack.l_mark[-6].ipp.f != 0 && ipnat_yystack.l_mark[-3].num != ipnat_yystack.l_mark[-6].ipp.f)
					ipnat_yyerror("21.address family mismatch");
				  if (nat->in_v[0] == 0) {
					if (ipnat_yystack.l_mark[-6].ipp.v != AF_UNSPEC)
						nat->in_v[0] = ftov(ipnat_yystack.l_mark[-6].ipp.f);
					  else
						nat->in_v[0] = ftov(ipnat_yystack.l_mark[-3].num);
				  }
				  nat->in_odstatype = ipnat_yystack.l_mark[-6].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-6].ipp.a, &nat->in_odst.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-6].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-6].ipp.m, &nat->in_odst.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-6].ipp.a));

				  setrdrifnames();
				}
break;
case 29:
#line 356 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_v[0] == 0)
					nat->in_v[0] = ftov(ipnat_yystack.l_mark[-3].ipp.f);
				  nat->in_odstatype = ipnat_yystack.l_mark[-3].ipp.t;
				  bcopy(&ipnat_yystack.l_mark[-3].ipp.a, &nat->in_odst.na_addr[0],
					sizeof(ipnat_yystack.l_mark[-3].ipp.a));
				  bcopy(&ipnat_yystack.l_mark[-3].ipp.m, &nat->in_odst.na_addr[1],
					sizeof(ipnat_yystack.l_mark[-3].ipp.a));

				  setrdrifnames();
				}
break;
case 30:
#line 367 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-3].num != 0 && ipnat_yystack.l_mark[-5].num != 0 && ipnat_yystack.l_mark[-3].num != ipnat_yystack.l_mark[-5].num)
					ipnat_yyerror("20.address family mismatch");
				  if (nat->in_v[0] == 0) {
					  if (ipnat_yystack.l_mark[-5].num != AF_UNSPEC)
						nat->in_v[0] = ftov(ipnat_yystack.l_mark[-5].num);
					  else
						nat->in_v[0] = ftov(ipnat_yystack.l_mark[-3].num);
				  }
				  setrdrifnames();
				}
break;
case 31:
#line 378 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_v[0] = ftov(ipnat_yystack.l_mark[-2].num);

				  setrdrifnames();
				}
break;
case 32:
#line 386 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_v[0] == 0)
					nat->in_v[0] = ftov(ipnat_yystack.l_mark[-3].num);
				  if (nat->in_redir & NAT_MAP)
					setmapifnames();
				  else
					setrdrifnames();
				  nat->in_redir |= NAT_REWRITE;
				}
break;
case 33:
#line 397 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_v[0] == 0)
					nat->in_v[0] = ftov(ipnat_yystack.l_mark[-3].num);
				  if (nat->in_redir & NAT_MAP) {
					setmapifnames();
					nat->in_pr[0] = IPPROTO_UDP;
				  } else {
					setrdrifnames();
					nat->in_pr[1] = IPPROTO_UDP;
				  }
				  nat->in_flags &= ~IPN_TCP;
				}
break;
case 34:
#line 410 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 35:
#line 413 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yysetdict(proxies); }
break;
case 36:
#line 415 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ proxy_setconfig(IPNY_DNS); }
break;
case 37:
#line 417 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ proxy_addconfig("dns", ipnat_yystack.l_mark[-7].num, ipnat_yystack.l_mark[-5].str, ipnat_yystack.l_mark[-2].names);
				  proxy_unsetconfig();
				}
break;
case 38:
#line 423 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.names = ipnat_yystack.l_mark[0].names; }
break;
case 39:
#line 424 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.names = ipnat_yystack.l_mark[-2].names; ipnat_yystack.l_mark[-2].names->na_next = ipnat_yystack.l_mark[0].names; }
break;
case 40:
#line 428 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.names = proxy_dns_add_pass(NULL, ipnat_yystack.l_mark[0].str); }
break;
case 41:
#line 429 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.names = proxy_dns_add_block(NULL, ipnat_yystack.l_mark[0].str); }
break;
case 42:
#line 430 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.names = proxy_dns_add_pass(".", ipnat_yystack.l_mark[0].str); }
break;
case 43:
#line 431 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.names = proxy_dns_add_block(".", ipnat_yystack.l_mark[0].str); }
break;
case 44:
#line 435 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ; }
break;
case 45:
#line 438 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_redir = NAT_REDIRECT; }
break;
case 46:
#line 439 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_redir = NAT_MAP; }
break;
case 49:
#line 447 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_nsrc.na_addr[0] = ipnat_yystack.l_mark[-4].ipp.a;
				  nat->in_nsrc.na_addr[1] = ipnat_yystack.l_mark[-4].ipp.m;
				  nat->in_nsrc.na_atype = ipnat_yystack.l_mark[-4].ipp.t;
				  if (ipnat_yystack.l_mark[-4].ipp.t == FRI_LOOKUP) {
					nat->in_nsrc.na_type = ipnat_yystack.l_mark[-4].ipp.u;
					nat->in_nsrc.na_subtype = ipnat_yystack.l_mark[-4].ipp.s;
					nat->in_nsrc.na_num = ipnat_yystack.l_mark[-4].ipp.n;
				  }
				  nat->in_nsports[0] = ipnat_yystack.l_mark[-3].pc.p1;
				  nat->in_nsports[1] = ipnat_yystack.l_mark[-3].pc.p2;
				  nat->in_ndst.na_addr[0] = ipnat_yystack.l_mark[-1].ipp.a;
				  nat->in_ndst.na_addr[1] = ipnat_yystack.l_mark[-1].ipp.m;
				  nat->in_ndst.na_atype = ipnat_yystack.l_mark[-1].ipp.t;
				  if (ipnat_yystack.l_mark[-1].ipp.t == FRI_LOOKUP) {
					nat->in_ndst.na_type = ipnat_yystack.l_mark[-1].ipp.u;
					nat->in_ndst.na_subtype = ipnat_yystack.l_mark[-1].ipp.s;
					nat->in_ndst.na_num = ipnat_yystack.l_mark[-1].ipp.n;
				  }
				  nat->in_ndports[0] = ipnat_yystack.l_mark[0].pc.p1;
				  nat->in_ndports[1] = ipnat_yystack.l_mark[0].pc.p2;
				}
break;
case 50:
#line 471 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_nsrc.na_addr[0] = ipnat_yystack.l_mark[-7].ipp.a;
				  if (ipnat_yystack.l_mark[-7].ipp.m.in4.s_addr != 0xffffffff)
					ipnat_yyerror("divert must have /32 dest");
				  nat->in_nsrc.na_addr[1] = ipnat_yystack.l_mark[-7].ipp.m;
				  nat->in_nsports[0] = ipnat_yystack.l_mark[-5].port;
				  nat->in_nsports[1] = ipnat_yystack.l_mark[-5].port;

				  nat->in_ndst.na_addr[0] = ipnat_yystack.l_mark[-3].ipp.a;
				  nat->in_ndst.na_addr[1] = ipnat_yystack.l_mark[-3].ipp.m;
				  if (ipnat_yystack.l_mark[-3].ipp.m.in4.s_addr != 0xffffffff)
					ipnat_yyerror("divert must have /32 dest");
				  nat->in_ndports[0] = ipnat_yystack.l_mark[-1].port;
				  nat->in_ndports[1] = ipnat_yystack.l_mark[-1].port;

				  nat->in_redir |= NAT_DIVERTUDP;
				}
break;
case 51:
#line 489 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 52:
#line 492 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 53:
#line 496 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].pc.p1;
				  ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].pc.p2;
				}
break;
case 54:
#line 500 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].port;
				  ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].port;
				  nat->in_flags |= IPN_FIXEDSPORT;
				}
break;
case 55:
#line 507 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].pc.p1;
				  ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].pc.p2;
				}
break;
case 56:
#line 511 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].port;
				  ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].port;
				  nat->in_flags |= IPN_FIXEDDPORT;
				}
break;
case 57:
#line 518 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = 0;
				  ipnat_yyval.pc.p2 = 0;
				}
break;
case 58:
#line 521 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (!(nat->in_flags & IPN_TCPUDP))
					ipnat_yyerror("must be TCP/UDP for ports");
				}
break;
case 59:
#line 524 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].pc.p1;
				  ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].pc.p2;
				}
break;
case 61:
#line 530 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int pos;
			  pos = addname(&nat, ipnat_yystack.l_mark[-2].str);
			  nat->in_plabel = pos;
			  if (nat->in_dcmp == 0) {
				nat->in_odport = ipnat_yystack.l_mark[-3].port;
			  } else if (ipnat_yystack.l_mark[-3].port != nat->in_odport) {
				ipnat_yyerror("proxy port numbers not consistant");
			  }
			  nat->in_ndport = ipnat_yystack.l_mark[-3].port;
			  setnatproto(ipnat_yystack.l_mark[0].num);
			  free(ipnat_yystack.l_mark[-2].str);
			}
break;
case 62:
#line 543 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int pnum, pos;
			  pos = addname(&nat, ipnat_yystack.l_mark[-2].str);
			  nat->in_plabel = pos;
			  pnum = getportproto(ipnat_yystack.l_mark[-3].str, ipnat_yystack.l_mark[0].num);
			  if (pnum == -1)
				ipnat_yyerror("invalid port number");
			  nat->in_odport = ntohs(pnum);
			  nat->in_ndport = ntohs(pnum);
			  setnatproto(ipnat_yystack.l_mark[0].num);
			  free(ipnat_yystack.l_mark[-3].str);
			  free(ipnat_yystack.l_mark[-2].str);
			}
break;
case 63:
#line 556 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int pos;
			  pos = addname(&nat, ipnat_yystack.l_mark[-4].str);
			  nat->in_plabel = pos;
			  if (nat->in_dcmp == 0) {
				nat->in_odport = ipnat_yystack.l_mark[-5].port;
			  } else if (ipnat_yystack.l_mark[-5].port != nat->in_odport) {
				ipnat_yyerror("proxy port numbers not consistant");
			  }
			  nat->in_ndport = ipnat_yystack.l_mark[-5].port;
			  setnatproto(ipnat_yystack.l_mark[-2].num);
			  nat->in_pconfig = addname(&nat, ipnat_yystack.l_mark[0].str);
			  free(ipnat_yystack.l_mark[-4].str);
			  free(ipnat_yystack.l_mark[0].str);
			}
break;
case 64:
#line 571 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int pnum, pos;
			  pos = addname(&nat, ipnat_yystack.l_mark[-4].str);
			  nat->in_plabel = pos;
			  pnum = getportproto(ipnat_yystack.l_mark[-5].str, ipnat_yystack.l_mark[-2].num);
			  if (pnum == -1)
				ipnat_yyerror("invalid port number");
			  nat->in_odport = ntohs(pnum);
			  nat->in_ndport = ntohs(pnum);
			  setnatproto(ipnat_yystack.l_mark[-2].num);
			  pos = addname(&nat, ipnat_yystack.l_mark[0].str);
			  nat->in_pconfig = pos;
			  free(ipnat_yystack.l_mark[-5].str);
			  free(ipnat_yystack.l_mark[-4].str);
			  free(ipnat_yystack.l_mark[0].str);
			}
break;
case 66:
#line 588 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_pr[0] != 0 ||
					      nat->in_pr[1] != 0 ||
					      nat->in_flags & IPN_TCPUDP)
						ipnat_yyerror("protocol set twice");
					  setnatproto(ipnat_yystack.l_mark[0].num);
					}
break;
case 67:
#line 594 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_pr[0] != 0 ||
					      nat->in_pr[1] != 0 ||
					      nat->in_flags & IPN_TCPUDP)
						ipnat_yyerror("protocol set twice");
					  nat->in_flags |= IPN_TCPUDP;
					  nat->in_pr[0] = 0;
					  nat->in_pr[1] = 0;
					}
break;
case 68:
#line 602 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_pr[0] != 0 ||
					      nat->in_pr[1] != 0 ||
					      nat->in_flags & IPN_TCPUDP)
						ipnat_yyerror("protocol set twice");
					  nat->in_flags |= IPN_TCPUDP;
					  nat->in_pr[0] = 0;
					  nat->in_pr[1] = 0;
					}
break;
case 69:
#line 613 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp = ipnat_yystack.l_mark[0].ipp;
					  ipnat_yyexpectaddr = 0;
					}
break;
case 70:
#line 616 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 71:
#line 617 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp.t = FRI_RANGE;
					  if (ipnat_yystack.l_mark[-3].ipa.f != ipnat_yystack.l_mark[0].ipa.f)
						ipnat_yyerror("8.address family "
							"mismatch");
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[-3].ipa.f;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[-3].ipa.f);
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-3].ipa.a;
					  ipnat_yyval.ipp.m = ipnat_yystack.l_mark[0].ipa.a;
					  nat->in_flags |= IPN_SIPRANGE;
					  ipnat_yyexpectaddr = 0;
					}
break;
case 72:
#line 628 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 73:
#line 629 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp.t = FRI_RANGE;
					  if (ipnat_yystack.l_mark[-3].ipa.f != ipnat_yystack.l_mark[0].ipa.f)
						ipnat_yyerror("9.address family "
							"mismatch");
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[-3].ipa.f;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[-3].ipa.f);
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-3].ipa.a;
					  ipnat_yyval.ipp.m = ipnat_yystack.l_mark[0].ipa.a;
					  nat->in_flags |= IPN_SIPRANGE;
					  ipnat_yyexpectaddr = 0;
					}
break;
case 74:
#line 643 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 75:
#line 644 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_SPLIT;
				  if (ipnat_yystack.l_mark[-3].ipa.f != ipnat_yystack.l_mark[0].ipa.f)
					ipnat_yyerror("10.address family "
						"mismatch");
				  ipnat_yyval.num = ipnat_yystack.l_mark[-3].ipa.f;
				  nat->in_ndstip6 = ipnat_yystack.l_mark[-3].ipa.a;
				  nat->in_ndstmsk6 = ipnat_yystack.l_mark[0].ipa.a;
				  nat->in_ndstatype = FRI_SPLIT;
				  ipnat_yyexpectaddr = 0;
				}
break;
case 76:
#line 654 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int bits;
				  nat->in_ndstip6 = ipnat_yystack.l_mark[0].ipp.a;
				  nat->in_ndstmsk6 = ipnat_yystack.l_mark[0].ipp.m;
				  nat->in_ndst.na_atype = ipnat_yystack.l_mark[0].ipp.t;
				  ipnat_yyexpectaddr = 0;
				  if (ipnat_yystack.l_mark[0].ipp.f == AF_INET)
					bits = count4bits(ipnat_yystack.l_mark[0].ipp.m.in4.s_addr);
				  else
					bits = count6bits(ipnat_yystack.l_mark[0].ipp.m.i6);
				  if ((ipnat_yystack.l_mark[0].ipp.f == AF_INET) && (bits != 0) &&
				      (bits != 32)) {
					ipnat_yyerror("dest ip bitmask not /32");
				  } else if ((ipnat_yystack.l_mark[0].ipp.f == AF_INET6) &&
					     (bits != 0) && (bits != 128)) {
					ipnat_yyerror("dest ip bitmask not /128");
				  }
				  ipnat_yyval.num = ipnat_yystack.l_mark[0].ipp.f;
				}
break;
case 77:
#line 675 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp = ipnat_yystack.l_mark[0].ipp;
					  ipnat_yyexpectaddr = 0;
					}
break;
case 78:
#line 678 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.t = FRI_RANGE;
					  if (ipnat_yystack.l_mark[-2].ipa.f != 0 && ipnat_yystack.l_mark[0].ipa.f != 0 &&
					      ipnat_yystack.l_mark[-2].ipa.f != ipnat_yystack.l_mark[0].ipa.f)
						ipnat_yyerror("11.address family "
							"mismatch");
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.m = ipnat_yystack.l_mark[0].ipa.a;
					  nat->in_flags |= IPN_DIPRANGE;
					  ipnat_yyexpectaddr = 0;
					}
break;
case 79:
#line 690 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.t = FRI_RANGE;
					  if (ipnat_yystack.l_mark[-2].ipa.f != 0 && ipnat_yystack.l_mark[0].ipa.f != 0 &&
					      ipnat_yystack.l_mark[-2].ipa.f != ipnat_yystack.l_mark[0].ipa.f)
						ipnat_yyerror("12.address family "
							"mismatch");
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.m = ipnat_yystack.l_mark[0].ipa.a;
					  nat->in_flags |= IPN_DIPRANGE;
					  ipnat_yyexpectaddr = 0;
					}
break;
case 80:
#line 704 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp = ipnat_yystack.l_mark[0].ipp; }
break;
case 81:
#line 705 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp.t = FRI_LOOKUP;
					  ipnat_yyval.ipp.u = IPLT_DSTLIST;
					  ipnat_yyval.ipp.s = 0;
					  ipnat_yyval.ipp.n = ipnat_yystack.l_mark[0].num;
					}
break;
case 82:
#line 710 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipp.t = FRI_LOOKUP;
					  ipnat_yyval.ipp.u = IPLT_DSTLIST;
					  ipnat_yyval.ipp.s = 1;
					  ipnat_yyval.ipp.n = addname(&nat, ipnat_yystack.l_mark[0].str);
					}
break;
case 83:
#line 717 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ suggest_port = 1; }
break;
case 84:
#line 721 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[0].num > 65535)	/* Unsigned */
						ipnat_yyerror("invalid port number");
					  else
						ipnat_yyval.port = ipnat_yystack.l_mark[0].num;
					}
break;
case 85:
#line 726 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (getport(NULL, ipnat_yystack.l_mark[0].str,
						      &(ipnat_yyval.port), NULL) == -1)
						ipnat_yyerror("invalid port number");
					  ipnat_yyval.port = ntohs(ipnat_yyval.port);
					}
break;
case 86:
#line 734 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].port; ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].port; }
break;
case 87:
#line 735 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[-2].port; ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].port; }
break;
case 88:
#line 736 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[-2].port; ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].port; }
break;
case 90:
#line 739 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_odport = ipnat_yystack.l_mark[0].pc.p1;
					  if (ipnat_yystack.l_mark[0].pc.p2 == 0)
						nat->in_dtop = ipnat_yystack.l_mark[0].pc.p1;
					  else
						nat->in_dtop = ipnat_yystack.l_mark[0].pc.p2;
					}
break;
case 92:
#line 747 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_dpmin = ipnat_yystack.l_mark[0].pc.p1;
					  nat->in_dpnext = ipnat_yystack.l_mark[0].pc.p1;
					  nat->in_dpmax = ipnat_yystack.l_mark[0].pc.p2;
					  nat->in_ndport = ipnat_yystack.l_mark[0].pc.p1;
					  if (nat->in_dtop == 0)
						nat->in_dtop = ipnat_yystack.l_mark[0].pc.p2;
					}
break;
case 93:
#line 754 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_dpmin = ipnat_yystack.l_mark[0].port;
					  nat->in_dpnext = ipnat_yystack.l_mark[0].port;
					  nat->in_ndport = ipnat_yystack.l_mark[0].port;
					  if (nat->in_dtop == 0)
						nat->in_dtop = nat->in_odport;
					  nat->in_flags |= IPN_FIXEDDPORT;
					}
break;
case 95:
#line 763 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_spmin = ipnat_yystack.l_mark[0].num; }
break;
case 96:
#line 764 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_AUTOPORTMAP; }
break;
case 97:
#line 767 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_redir = NAT_MAP; }
break;
case 98:
#line 768 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_redir = NAT_BIMAP; }
break;
case 99:
#line 771 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_redir = NAT_REDIRECT; }
break;
case 100:
#line 775 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_redir = NAT_MAPBLK; }
break;
case 101:
#line 779 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-2].num != 0 && ipnat_yystack.l_mark[0].num != 0 && ipnat_yystack.l_mark[-2].num != ipnat_yystack.l_mark[0].num)
						ipnat_yyerror("13.address family "
							"mismatch");
					  ipnat_yyval.num = ipnat_yystack.l_mark[-2].num;
					}
break;
case 102:
#line 785 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-3].num != 0 && ipnat_yystack.l_mark[0].num != 0 && ipnat_yystack.l_mark[-3].num != ipnat_yystack.l_mark[0].num)
						ipnat_yyerror("14.address family "
							"mismatch");
					  nat->in_flags |= IPN_NOTDST;
					  ipnat_yyval.num = ipnat_yystack.l_mark[-3].num;
					}
break;
case 103:
#line 792 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-3].num != 0 && ipnat_yystack.l_mark[0].num != 0 && ipnat_yystack.l_mark[-3].num != ipnat_yystack.l_mark[0].num)
						ipnat_yyerror("15.address family "
							"mismatch");
					  nat->in_flags |= IPN_NOTDST;
					  ipnat_yyval.num = ipnat_yystack.l_mark[-3].num;
					}
break;
case 104:
#line 801 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-2].num != 0 && ipnat_yystack.l_mark[0].num != 0 && ipnat_yystack.l_mark[-2].num != ipnat_yystack.l_mark[0].num)
						ipnat_yyerror("16.address family "
							"mismatch");
					  ipnat_yyval.num = ipnat_yystack.l_mark[-2].num;
					}
break;
case 105:
#line 807 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-2].num != 0 && ipnat_yystack.l_mark[0].num != 0 && ipnat_yystack.l_mark[-2].num != ipnat_yystack.l_mark[0].num)
						ipnat_yyerror("17.address family "
							"mismatch");
					  nat->in_flags |= IPN_NOTSRC;
					  ipnat_yyval.num = ipnat_yystack.l_mark[-2].num;
					}
break;
case 106:
#line 814 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-2].num != 0 && ipnat_yystack.l_mark[0].num != 0 && ipnat_yystack.l_mark[-2].num != ipnat_yystack.l_mark[0].num)
						ipnat_yyerror("18.address family "
							"mismatch");
					  nat->in_flags |= IPN_NOTSRC;
					  ipnat_yyval.num = ipnat_yystack.l_mark[-2].num;
					}
break;
case 107:
#line 822 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_FILTER;
					  ipnat_yyexpectaddr = 1;
					}
break;
case 108:
#line 827 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 109:
#line 831 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 110:
#line 832 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 1; }
break;
case 111:
#line 835 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ setifname(&nat, 0, ipnat_yystack.l_mark[0].str);
					  free(ipnat_yystack.l_mark[0].str);
					}
break;
case 113:
#line 840 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_v[0] = 4; nat->in_v[1] = 4; }
break;
case 114:
#line 841 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_v[0] = 6; nat->in_v[1] = 6; }
break;
case 115:
#line 845 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ setifname(&nat, 1, ipnat_yystack.l_mark[0].str);
					  free(ipnat_yystack.l_mark[0].str);
					}
break;
case 116:
#line 852 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_spmin = ipnat_yystack.l_mark[-1].pc.p1;
					  nat->in_spmax = ipnat_yystack.l_mark[-1].pc.p2;
					}
break;
case 117:
#line 856 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_spmin = ipnat_yystack.l_mark[-2].pc.p1;
					  nat->in_spmax = ipnat_yystack.l_mark[-2].pc.p2;
					}
break;
case 118:
#line 860 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_AUTOPORTMAP;
					  nat->in_spmin = 1024;
					  nat->in_spmax = 65535;
					}
break;
case 119:
#line 865 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (strcmp(ipnat_yystack.l_mark[-2].str, "icmp") != 0 &&
			      strcmp(ipnat_yystack.l_mark[-2].str, "ipv6-icmp") != 0) {
				ipnat_yyerror("icmpidmap not followed by icmp");
			  }
			  free(ipnat_yystack.l_mark[-2].str);
			  if (ipnat_yystack.l_mark[-1].pc.p1 < 0 || ipnat_yystack.l_mark[-1].pc.p1 > 65535)
				ipnat_yyerror("invalid 1st ICMP Id number");
			  if (ipnat_yystack.l_mark[-1].pc.p2 < 0 || ipnat_yystack.l_mark[-1].pc.p2 > 65535)
				ipnat_yyerror("invalid 2nd ICMP Id number");
			  if (strcmp(ipnat_yystack.l_mark[-2].str, "ipv6-icmp") == 0) {
				nat->in_pr[0] = IPPROTO_ICMPV6;
				nat->in_pr[1] = IPPROTO_ICMPV6;
			  } else {
				nat->in_pr[0] = IPPROTO_ICMP;
				nat->in_pr[1] = IPPROTO_ICMP;
			  }
			  nat->in_flags = IPN_ICMPQUERY;
			  nat->in_spmin = ipnat_yystack.l_mark[-1].pc.p1;
			  nat->in_spmax = ipnat_yystack.l_mark[-1].pc.p2;
			}
break;
case 120:
#line 888 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = ipnat_yystack.l_mark[0].num; }
break;
case 121:
#line 889 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_osport = ipnat_yystack.l_mark[0].pc.p1;
					  nat->in_stop = ipnat_yystack.l_mark[0].pc.p2;
					  nat->in_scmp = ipnat_yystack.l_mark[0].pc.pc;
					  ipnat_yyval.num = ipnat_yystack.l_mark[-2].num;
					}
break;
case 122:
#line 896 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_osrcatype = ipnat_yystack.l_mark[0].ipp.t;
					  bcopy(&ipnat_yystack.l_mark[0].ipp.a,
						&nat->in_osrc.na_addr[0],
						sizeof(ipnat_yystack.l_mark[0].ipp.a));
					  bcopy(&ipnat_yystack.l_mark[0].ipp.m,
						&nat->in_osrc.na_addr[1],
						sizeof(ipnat_yystack.l_mark[0].ipp.m));
					  ipnat_yyval.num = ipnat_yystack.l_mark[0].ipp.f;
					}
break;
case 123:
#line 908 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = ipnat_yystack.l_mark[0].num; }
break;
case 124:
#line 909 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_odport = ipnat_yystack.l_mark[0].pc.p1;
					  nat->in_dtop = ipnat_yystack.l_mark[0].pc.p2;
					  nat->in_dcmp = ipnat_yystack.l_mark[0].pc.pc;
					  ipnat_yyval.num = ipnat_yystack.l_mark[-2].num;
					}
break;
case 125:
#line 916 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_odstatype = ipnat_yystack.l_mark[0].ipp.t;
					  bcopy(&ipnat_yystack.l_mark[0].ipp.a,
						&nat->in_odst.na_addr[0],
						sizeof(ipnat_yystack.l_mark[0].ipp.a));
					  bcopy(&ipnat_yystack.l_mark[0].ipp.m,
						&nat->in_odst.na_addr[1],
						sizeof(ipnat_yystack.l_mark[0].ipp.m));
					  ipnat_yyval.num = ipnat_yystack.l_mark[0].ipp.f;
					}
break;
case 126:
#line 927 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 0;
					  bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					}
break;
case 127:
#line 931 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[0].ipa.a;
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[0].ipa.f);
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[0].ipa.f;
					  if (ipnat_yyval.ipp.f == AF_INET) {
						  ipnat_yyval.ipp.m.in4.s_addr = 0xffffffff;
					  } else if (ipnat_yyval.ipp.f == AF_INET6) {
						  ipnat_yyval.ipp.m.i6[0] = 0xffffffff;
						  ipnat_yyval.ipp.m.i6[1] = 0xffffffff;
						  ipnat_yyval.ipp.m.i6[2] = 0xffffffff;
						  ipnat_yyval.ipp.m.i6[3] = 0xffffffff;
					  }
					  ipnat_yyexpectaddr = 0;
					}
break;
case 128:
#line 947 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[-2].ipa.f;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[-2].ipa.f);
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					  ntomask(ipnat_yyval.ipp.f, ipnat_yystack.l_mark[0].num, (u_32_t *)&ipnat_yyval.ipp.m);
					  ipnat_yyval.ipp.a.i6[0] &= ipnat_yyval.ipp.m.i6[0];
					  ipnat_yyval.ipp.a.i6[1] &= ipnat_yyval.ipp.m.i6[1];
					  ipnat_yyval.ipp.a.i6[2] &= ipnat_yyval.ipp.m.i6[2];
					  ipnat_yyval.ipp.a.i6[3] &= ipnat_yyval.ipp.m.i6[3];
					  ipnat_yyexpectaddr = 0;
					}
break;
case 129:
#line 959 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  if (ipnat_yystack.l_mark[-2].ipa.f != ipnat_yystack.l_mark[0].ipa.f) {
						ipnat_yyerror("1.address family "
							"mismatch");
					  }
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.m = ipnat_yystack.l_mark[0].ipa.a;
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					  ipnat_yyval.ipp.a.i6[0] &= ipnat_yyval.ipp.m.i6[0];
					  ipnat_yyval.ipp.a.i6[1] &= ipnat_yyval.ipp.m.i6[1];
					  ipnat_yyval.ipp.a.i6[2] &= ipnat_yyval.ipp.m.i6[2];
					  ipnat_yyval.ipp.a.i6[3] &= ipnat_yyval.ipp.m.i6[3];
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[-2].ipa.f;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[-2].ipa.f);
					  ipnat_yyexpectaddr = 0;
					}
break;
case 130:
#line 975 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.m.in4.s_addr = htonl(ipnat_yystack.l_mark[0].num);
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					  ipnat_yyval.ipp.a.in4.s_addr &= ipnat_yyval.ipp.m.in4.s_addr;
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[-2].ipa.f;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[-2].ipa.f);
					  if (ipnat_yyval.ipp.f == AF_INET6)
						ipnat_yyerror("incorrect inet6 mask");
					}
break;
case 131:
#line 985 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  if (ipnat_yystack.l_mark[-2].ipa.f != ipnat_yystack.l_mark[0].ipa.f) {
						ipnat_yyerror("2.address family "
							"mismatch");
					  }
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.m = ipnat_yystack.l_mark[0].ipa.a;
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					  ipnat_yyval.ipp.a.i6[0] &= ipnat_yyval.ipp.m.i6[0];
					  ipnat_yyval.ipp.a.i6[1] &= ipnat_yyval.ipp.m.i6[1];
					  ipnat_yyval.ipp.a.i6[2] &= ipnat_yyval.ipp.m.i6[2];
					  ipnat_yyval.ipp.a.i6[3] &= ipnat_yyval.ipp.m.i6[3];
					  ipnat_yyval.ipp.f = ipnat_yystack.l_mark[-2].ipa.f;
					  ipnat_yyval.ipp.v = ftov(ipnat_yystack.l_mark[-2].ipa.f);
					  ipnat_yyexpectaddr = 0;
					}
break;
case 132:
#line 1001 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a = ipnat_yystack.l_mark[-2].ipa.a;
					  ipnat_yyval.ipp.m.in4.s_addr = htonl(ipnat_yystack.l_mark[0].num);
					  ipnat_yyval.ipp.t = FRI_NORMAL;
					  ipnat_yyval.ipp.a.in4.s_addr &= ipnat_yyval.ipp.m.in4.s_addr;
					  ipnat_yyval.ipp.f = AF_INET;
					  ipnat_yyval.ipp.v = 4;
					}
break;
case 133:
#line 1009 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a.iplookupnum = ipnat_yystack.l_mark[0].num;
					  ipnat_yyval.ipp.a.iplookuptype = IPLT_POOL;
					  ipnat_yyval.ipp.a.iplookupsubtype = 0;
					  ipnat_yyval.ipp.t = FRI_LOOKUP;
					}
break;
case 134:
#line 1015 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a.iplookupname = addname(&nat,ipnat_yystack.l_mark[0].str);
					  ipnat_yyval.ipp.a.iplookuptype = IPLT_POOL;
					  ipnat_yyval.ipp.a.iplookupsubtype = 1;
					  ipnat_yyval.ipp.t = FRI_LOOKUP;
					}
break;
case 135:
#line 1021 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a.iplookupnum = ipnat_yystack.l_mark[0].num;
					  ipnat_yyval.ipp.a.iplookuptype = IPLT_HASH;
					  ipnat_yyval.ipp.a.iplookupsubtype = 0;
					  ipnat_yyval.ipp.t = FRI_LOOKUP;
					}
break;
case 136:
#line 1027 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ bzero(&ipnat_yyval.ipp, sizeof(ipnat_yyval.ipp));
					  ipnat_yyval.ipp.a.iplookupname = addname(&nat,ipnat_yystack.l_mark[0].str);
					  ipnat_yyval.ipp.a.iplookuptype = IPLT_HASH;
					  ipnat_yyval.ipp.a.iplookupsubtype = 1;
					  ipnat_yyval.ipp.t = FRI_LOOKUP;
					}
break;
case 137:
#line 1035 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 0; }
break;
case 138:
#line 1038 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyexpectaddr = 0; }
break;
case 139:
#line 1041 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (!(nat->in_flags & IPN_FILTER)) {
						ipnat_yyerror("Can only use pool with from/to rules\n");
					  }
					  ipnat_yyexpectaddr = 0;
					  ipnat_yyresetdict();
					}
break;
case 140:
#line 1049 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (!(nat->in_flags & IPN_FILTER)) {
						ipnat_yyerror("Can only use hash with from/to rules\n");
					  }
					  ipnat_yyexpectaddr = 0;
					  ipnat_yyresetdict();
					}
break;
case 141:
#line 1058 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.pc = ipnat_yystack.l_mark[-1].num; ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[0].port; ipnat_yyval.pc.p2 = 0; }
break;
case 142:
#line 1059 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.pc.pc = ipnat_yystack.l_mark[-1].num; ipnat_yyval.pc.p1 = ipnat_yystack.l_mark[-2].port; ipnat_yyval.pc.p2 = ipnat_yystack.l_mark[0].port; }
break;
case 146:
#line 1070 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ strncpy(nat->in_tag.ipt_tag, ipnat_yystack.l_mark[0].str,
						  sizeof(nat->in_tag.ipt_tag));
					}
break;
case 148:
#line 1073 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_ROUNDR; }
break;
case 150:
#line 1076 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_FRAG; }
break;
case 152:
#line 1079 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_age[0] = ipnat_yystack.l_mark[0].num;
						  nat->in_age[1] = ipnat_yystack.l_mark[0].num; }
break;
case 153:
#line 1081 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_age[0] = ipnat_yystack.l_mark[-2].num;
						  nat->in_age[1] = ipnat_yystack.l_mark[0].num; }
break;
case 155:
#line 1085 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (!(nat->in_flags & IPN_ROUNDR) &&
					      !(nat->in_flags & IPN_SPLIT)) {
						FPRINTF(stderr,
		"'sticky' for use with round-robin/IP splitting only\n");
					  } else
						nat->in_flags |= IPN_STICKY;
					}
break;
case 157:
#line 1095 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_mssclamp = ipnat_yystack.l_mark[0].num; }
break;
case 158:
#line 1098 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ setnatproto(IPPROTO_TCP); }
break;
case 159:
#line 1099 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ setnatproto(IPPROTO_UDP); }
break;
case 160:
#line 1100 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_TCPUDP;
					  nat->in_pr[0] = 0;
					  nat->in_pr[1] = 0;
					}
break;
case 161:
#line 1104 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_TCPUDP;
					  nat->in_pr[0] = 0;
					  nat->in_pr[1] = 0;
					}
break;
case 163:
#line 1111 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_SEQUENTIAL; }
break;
case 165:
#line 1115 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_PURGE; }
break;
case 166:
#line 1120 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ int pos;
					  pos = addname(&nat, ipnat_yystack.l_mark[0].str);
					  nat->in_plabel = pos;
					  nat->in_odport = nat->in_dpnext;
					  nat->in_dtop = nat->in_odport;
					  free(ipnat_yystack.l_mark[0].str);
					}
break;
case 167:
#line 1127 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (nat->in_plabel != -1) {
					nat->in_ndport = nat->in_odport;
					nat->in_dpmin = nat->in_odport;
					nat->in_dpmax = nat->in_dpmin;
					nat->in_dtop = nat->in_dpmin;
					nat->in_dpnext = nat->in_dpmin;
				  }
				}
break;
case 169:
#line 1138 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ nat->in_flags |= IPN_PURGE; }
break;
case 170:
#line 1141 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = ipnat_yystack.l_mark[0].num;
					  if (ipnat_yyval.num != IPPROTO_TCP &&
					      ipnat_yyval.num != IPPROTO_UDP)
						suggest_port = 0;
					}
break;
case 171:
#line 1146 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = IPPROTO_TCP; }
break;
case 172:
#line 1147 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = IPPROTO_UDP; }
break;
case 173:
#line 1148 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = getproto(ipnat_yystack.l_mark[0].str);
					  free(ipnat_yystack.l_mark[0].str);
					  if (ipnat_yyval.num == -1)
						ipnat_yyerror("unknown protocol");
					  if (ipnat_yyval.num != IPPROTO_TCP &&
					      ipnat_yyval.num != IPPROTO_UDP)
						suggest_port = 0;
					}
break;
case 174:
#line 1159 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = ipnat_yystack.l_mark[0].num; }
break;
case 175:
#line 1163 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ i6addr_t addr;
					  int family;

#ifdef USE_INET6
					  if (nat->in_v[0] == 6)
						family = AF_INET6;
					  else
#endif
						family = AF_INET;
					  memset(&(ipnat_yyval.ipa), 0, sizeof(ipnat_yyval.ipa));
					  memset(&addr, 0, sizeof(addr));
					  ipnat_yyval.ipa.f = family;
					  if (gethost(family, ipnat_yystack.l_mark[0].str,
						      &addr) == 0) {
						ipnat_yyval.ipa.a = addr;
					  } else {
						FPRINTF(stderr,
							"Unknown host '%s'\n",
							ipnat_yystack.l_mark[0].str);
					  }
					  free(ipnat_yystack.l_mark[0].str);
					}
break;
case 176:
#line 1185 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ memset(&(ipnat_yyval.ipa), 0, sizeof(ipnat_yyval.ipa));
					  ipnat_yyval.ipa.a.in4.s_addr = htonl(ipnat_yystack.l_mark[0].num);
					  if (ipnat_yyval.ipa.a.in4.s_addr != 0)
						ipnat_yyval.ipa.f = AF_INET;
					}
break;
case 177:
#line 1190 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipa = ipnat_yystack.l_mark[0].ipa; }
break;
case 178:
#line 1191 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ memset(&(ipnat_yyval.ipa), 0, sizeof(ipnat_yyval.ipa));
					  ipnat_yyval.ipa.a = ipnat_yystack.l_mark[0].ip6;
					  ipnat_yyval.ipa.f = AF_INET6;
					}
break;
case 179:
#line 1195 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ memset(&(ipnat_yyval.ipa), 0, sizeof(ipnat_yyval.ipa));
					  ipnat_yyval.ipa.a = ipnat_yystack.l_mark[0].ip6;
					  ipnat_yyval.ipa.f = AF_INET6;
					}
break;
case 180:
#line 1202 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_EQUAL; }
break;
case 181:
#line 1203 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_EQUAL; }
break;
case 182:
#line 1204 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_NEQUAL; }
break;
case 183:
#line 1205 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_LESST; }
break;
case 184:
#line 1206 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_LESSTE; }
break;
case 185:
#line 1207 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_GREATERT; }
break;
case 186:
#line 1208 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_GREATERTE; }
break;
case 187:
#line 1211 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_OUTRANGE; }
break;
case 188:
#line 1212 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_INRANGE; }
break;
case 189:
#line 1213 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.num = FR_INCRANGE; }
break;
case 190:
#line 1216 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipa = ipnat_yystack.l_mark[0].ipa; }
break;
case 191:
#line 1217 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ ipnat_yyval.ipa.a = ipnat_yystack.l_mark[0].ip6;
					  ipnat_yyval.ipa.f = AF_INET6;
					}
break;
case 192:
#line 1223 "/usr/home/freebsd/omega/src/sbin/ipf/ipnat/../../../contrib/ipfilter/tools/ipnat_y.y"
	{ if (ipnat_yystack.l_mark[-6].num > 255 || ipnat_yystack.l_mark[-4].num > 255 || ipnat_yystack.l_mark[-2].num > 255 || ipnat_yystack.l_mark[0].num > 255) {
			ipnat_yyerror("Invalid octet string for IP address");
			return 0;
		  }
		  bzero((char *)&ipnat_yyval.ipa, sizeof(ipnat_yyval.ipa));
		  ipnat_yyval.ipa.a.in4.s_addr = (ipnat_yystack.l_mark[-6].num << 24) | (ipnat_yystack.l_mark[-4].num << 16) | (ipnat_yystack.l_mark[-2].num << 8) | ipnat_yystack.l_mark[0].num;
		  ipnat_yyval.ipa.a.in4.s_addr = htonl(ipnat_yyval.ipa.a.in4.s_addr);
		  ipnat_yyval.ipa.f = AF_INET;
		}
break;
#line 3076 "ipnat_y.c"
    }
    ipnat_yystack.s_mark -= ipnat_yym;
    ipnat_yystate = *ipnat_yystack.s_mark;
    ipnat_yystack.l_mark -= ipnat_yym;
    ipnat_yym = ipnat_yylhs[ipnat_yyn];
    if (ipnat_yystate == 0 && ipnat_yym == 0)
    {
#if YYDEBUG
        if (ipnat_yydebug)
            printf("%sdebug: after reduction, shifting from state 0 to\
 state %d\n", YYPREFIX, YYFINAL);
#endif
        ipnat_yystate = YYFINAL;
        *++ipnat_yystack.s_mark = YYFINAL;
        *++ipnat_yystack.l_mark = ipnat_yyval;
        if (ipnat_yychar < 0)
        {
            if ((ipnat_yychar = YYLEX) < 0) ipnat_yychar = YYEOF;
#if YYDEBUG
            if (ipnat_yydebug)
            {
                ipnat_yys = ipnat_yyname[YYTRANSLATE(ipnat_yychar)];
                printf("%sdebug: state %d, reading %d (%s)\n",
                        YYPREFIX, YYFINAL, ipnat_yychar, ipnat_yys);
            }
#endif
        }
        if (ipnat_yychar == YYEOF) goto ipnat_yyaccept;
        goto ipnat_yyloop;
    }
    if ((ipnat_yyn = ipnat_yygindex[ipnat_yym]) && (ipnat_yyn += ipnat_yystate) >= 0 &&
            ipnat_yyn <= YYTABLESIZE && ipnat_yycheck[ipnat_yyn] == ipnat_yystate)
        ipnat_yystate = ipnat_yytable[ipnat_yyn];
    else
        ipnat_yystate = ipnat_yydgoto[ipnat_yym];
#if YYDEBUG
    if (ipnat_yydebug)
        printf("%sdebug: after reduction, shifting from state %d \
to state %d\n", YYPREFIX, *ipnat_yystack.s_mark, ipnat_yystate);
#endif
    if (ipnat_yystack.s_mark >= ipnat_yystack.s_last && ipnat_yygrowstack(&ipnat_yystack) == YYENOMEM)
    {
        goto ipnat_yyoverflow;
    }
    *++ipnat_yystack.s_mark = (YYINT) ipnat_yystate;
    *++ipnat_yystack.l_mark = ipnat_yyval;
    goto ipnat_yyloop;

ipnat_yyoverflow:
    YYERROR_CALL("yacc stack overflow");

ipnat_yyabort:
    ipnat_yyfreestack(&ipnat_yystack);
    return (1);

ipnat_yyaccept:
    ipnat_yyfreestack(&ipnat_yystack);
    return (0);
}
